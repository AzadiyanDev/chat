import{a as we,b as ke,d as Se,e as Te,f as Me,g as Ie,h as Re}from"./chunk-UQYD26KG.js";import{a as Pe,b as Ve,e as Ae,h as De}from"./chunk-MOSGNJTJ.js";import{$ as l,A as E,Aa as pe,B as de,Ba as ue,Da as U,Ea as Ce,Fa as X,G as Z,Ga as B,H as a,I as xe,L as $,Oa as ye,Qa as be,T as Q,U as v,Ua as Ee,V as C,W as O,X as _e,Y as V,Z as A,_ as P,aa as c,ba as h,ca as b,d as he,da as M,ea as j,fa as k,ga as me,ha as _,ia as F,ja as s,ka as ee,la as te,ma as Y,n as fe,na as K,oa as w,pa as m,qa as S,r as L,ra as R,t as p,u,v as H,va as J,w as ce,wa as G,xa as y,ya as ve}from"./chunk-MLBTRJRA.js";import{a as q,b as ge}from"./chunk-E6TGZIGP.js";var ie=class o{constructor(){this.storageService=L(Se);this.mediaRecorder=null;this.audioChunks=[];this.isRecording=E(!1);this.recordingDuration=E(0);this.audioCtx=null}getAudioCtx(){return this.audioCtx||(this.audioCtx=new AudioContext),this.audioCtx}async startRecording(){try{let t=await navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(t),this.audioChunks=[],this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.audioChunks.push(e.data)},this.mediaRecorder.start(),this.isRecording.set(!0),this.recordingDuration.set(0),this.timerInterval=setInterval(()=>{this.recordingDuration.update(e=>e+1)},1e3)}catch(t){console.error("Microphone access error:",t),alert("Microphone access is required to record voice messages.")}}stopRecording(){return new Promise(t=>{if(!this.mediaRecorder||this.mediaRecorder.state==="inactive")return t(null);this.mediaRecorder.onstop=async()=>{clearInterval(this.timerInterval);let e=new Blob(this.audioChunks,{type:"audio/webm"}),i=this.recordingDuration()*1e3,n=[];try{let g=await e.arrayBuffer(),f=await this.getAudioCtx().decodeAudioData(g.slice(0));i=f.duration*1e3;let T=f.getChannelData(0),x=50,D=Math.floor(T.length/x);for(let N=0;N<x;N++){let z=0;for(let se=0;se<D;se++)z+=Math.abs(T[N*D+se]);n.push(z/D)}let I=Math.max(...n,.01);n=n.map(N=>Math.max(.1,N/I))}catch(g){console.error("Audio decode error, using fallback",g),n=Array.from({length:50},()=>Math.random()*.8+.2)}let r="voice_"+Date.now()+"_"+Math.random().toString(36).substr(2,5);await this.storageService.saveVoice(r,e);let d=URL.createObjectURL(e);this.isRecording.set(!1),this.recordingDuration.set(0),this.mediaRecorder?.stream.getTracks().forEach(g=>g.stop()),this.mediaRecorder=null,t({blob:e,blobUrl:d,durationMs:i,waveform:n,storageKey:r})},this.mediaRecorder.stop()})}cancelRecording(){this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(this.mediaRecorder.stop(),clearInterval(this.timerInterval),this.isRecording.set(!1),this.recordingDuration.set(0),this.mediaRecorder.stream.getTracks().forEach(t=>t.stop()),this.mediaRecorder=null)}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=fe({token:o,factory:o.\u0275fac,providedIn:"root"})}};var Ue=["audioElement"],$e=["playBtn"],Ne=["speedBtn"];function ze(o,t){o&1&&(H(),j(0,"rect",17)(1,"rect",18))}function He(o,t){o&1&&(H(),j(0,"path",7))}function Oe(o,t){if(o&1&&(H(),j(0,"rect")),o&2){let e=t.$implicit,i=t.$index,n=s();Q("x",i*(100/n.waveform().length)+"%")("y",(100-e*100)/2+"%")("width",100/n.waveform().length*.6+"%")("height",n.Math.max(e*100,6)+"%")("rx",1.5)("fill",n.unplayedColor())}}function Ge(o,t){if(o&1&&(H(),j(0,"rect")),o&2){let e=t.$implicit,i=t.$index,n=s();Q("x",i*(100/n.waveform().length)+"%")("y",(100-e*100)/2+"%")("width",100/n.waveform().length*.6+"%")("height",n.Math.max(e*100,6)+"%")("rx",1.5)("fill",n.playedColor())}}var ne=class o{constructor(){this.audioUrl=X.required();this.durationMs=X.required();this.waveform=X([]);this.isMine=X(!1);this.audioRef=B("audioElement");this.playBtn=B("playBtn");this.speedBtn=B("speedBtn");this.isPlaying=E(!1);this.currentTime=E(0);this.progressPercentage=E(0);this.playbackSpeed=E(1);this.instanceId=Math.random().toString(36).substring(2,8);this.Math=Math;this.speeds=[1,1.5,2,.5]}playedColor(){return this.isMine()?"#ffffff":"#3390ec"}unplayedColor(){return this.isMine()?"rgba(255,255,255,0.3)":"rgba(150,150,150,0.3)"}togglePlay(t){t.stopPropagation();let e=this.audioRef()?.nativeElement;if(!e)return;this.isPlaying()?(e.pause(),this.isPlaying.set(!1)):(e.playbackRate=this.playbackSpeed(),e.play().catch(n=>console.error("Audio play failed",n)),this.isPlaying.set(!0));let i=this.playBtn()?.nativeElement;i&&typeof gsap<"u"&&gsap.fromTo(i,{scale:.8},{scale:1,duration:.4,ease:"elastic.out(1.2, 0.4)"})}cycleSpeed(t){t.stopPropagation();let i=(this.speeds.indexOf(this.playbackSpeed())+1)%this.speeds.length;this.playbackSpeed.set(this.speeds[i]);let n=this.audioRef()?.nativeElement;n&&(n.playbackRate=this.playbackSpeed());let r=this.speedBtn()?.nativeElement;r&&typeof gsap<"u"&&gsap.fromTo(r,{scale:.7,rotation:-10},{scale:1,rotation:0,duration:.4,ease:"elastic.out(1, 0.3)"})}scrub(t){t.stopPropagation();let i=t.currentTarget.getBoundingClientRect(),n=Math.max(0,Math.min(1,(t.clientX-i.left)/i.width)),r=this.audioRef()?.nativeElement,d=this.durationMs()/1e3;r&&d>0&&(r.currentTime=n*d,this.currentTime.set(r.currentTime),this.progressPercentage.set(n*100))}onTimeUpdate(t){let e=t.target;this.currentTime.set(e.currentTime);let i=this.durationMs()/1e3;i>0&&this.progressPercentage.set(e.currentTime/i*100)}onEnded(){this.isPlaying.set(!1),this.currentTime.set(0),this.progressPercentage.set(0);let t=this.audioRef()?.nativeElement;t&&(t.currentTime=0)}formatTime(t){if(isNaN(t)||!isFinite(t))return"0:00";let e=Math.floor(t/60),i=Math.floor(t%60);return`${e}:${i<10?"0":""}${i}`}ngOnDestroy(){let t=this.audioRef()?.nativeElement;t&&(t.pause(),t.removeAttribute("src"),t.load())}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=$({type:o,selectors:[["app-voice-player"]],viewQuery:function(e,i){e&1&&ee(i.audioRef,Ue,5)(i.playBtn,$e,5)(i.speedBtn,Ne,5),e&2&&te(3)},inputs:{audioUrl:[1,"audioUrl"],durationMs:[1,"durationMs"],waveform:[1,"waveform"],isMine:[1,"isMine"]},decls:25,vars:20,consts:[["playBtn",""],["svgScrubber",""],["speedBtn",""],["audioElement",""],[1,"flex","items-center","gap-3","h-12","min-w-[220px]","max-w-full"],[1,"w-11","h-11","rounded-full","flex","items-center","justify-center","shrink-0","shadow-sm","transition-all","active:scale-90","hover:shadow-md",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M6 4.832c0-1.429 1.554-2.318 2.794-1.598l12.255 7.168c1.218.712 1.218 2.484 0 3.196L8.794 20.766C7.554 21.486 6 20.597 6 19.168V4.832z"],[1,"flex","flex-col","flex-1","justify-center","relative","h-full"],["preserveAspectRatio","none",1,"w-full","h-8","cursor-pointer",3,"click"],[3,"id"],["x","0","y","0","height","100%"],["cy","50%","r","4",1,"transition-all"],[1,"flex","justify-between","items-center","text-[10px]","font-medium","leading-none"],[1,"tabular-nums"],[1,"px-1.5","py-0.5","rounded-full","text-[9px]","font-bold","transition-all","hover:scale-105","active:scale-95",3,"click"],[1,"hidden",3,"ended","timeupdate","src"],["x","5","y","4","width","5","height","16","rx","1.5"],["x","14","y","4","width","5","height","16","rx","1.5"]],template:function(e,i){if(e&1){let n=k();b(0,"div",4)(1,"button",5,0),F("click",function(d){return p(n),u(i.togglePlay(d))}),H(),b(3,"svg",6),v(4,ze,2,0)(5,He,1,0,":svg:path",7),M()(),ce(),b(6,"div",8),H(),b(7,"svg",9,1),F("click",function(d){return p(n),u(i.scrub(d))}),V(9,Oe,1,6,":svg:rect",null,O),b(11,"clipPath",10),j(12,"rect",11),M(),b(13,"g"),V(14,Ge,1,6,":svg:rect",null,O),M(),j(16,"circle",12),M(),ce(),b(17,"div",13)(18,"span",14),m(19),M(),b(20,"button",15,2),F("click",function(d){return p(n),u(i.cycleSpeed(d))}),m(22),M()()(),b(23,"audio",16,3),F("ended",function(){return p(n),u(i.onEnded())})("timeupdate",function(d){return p(n),u(i.onTimeUpdate(d))}),M()()}e&2&&(a(),w(i.isMine()?"bg-white/90 text-telegram-primary":"bg-telegram-primary text-white"),a(3),C(i.isPlaying()?4:5),a(5),A(i.waveform()),a(2),me("id",ve("waveform-clip-",i.instanceId)),a(),Q("width",i.progressPercentage()+"%"),a(),Q("clip-path","url(#waveform-clip-"+i.instanceId+")"),a(),A(i.waveform()),a(2),K("opacity-100",i.isPlaying())("opacity-0",!i.isPlaying()),Q("cx",i.progressPercentage()+"%")("fill",i.playedColor()),a(),w(i.isMine()?"text-white/70":"text-gray-400 dark:text-gray-500"),a(2),S(i.formatTime(i.isPlaying()?i.currentTime():i.durationMs()/1e3)),a(),w(i.isMine()?"bg-white/20 text-white":"bg-gray-200 dark:bg-gray-700"),a(2),R(" ",i.playbackSpeed(),"x "),a(),me("src",i.audioUrl()))},encapsulation:2})}};var Xe=(o,t)=>t.id;function qe(o,t){if(o&1){let e=k();b(0,"button",9),F("click",function(){let n=p(e).$implicit,r=s();return u(r.activeCategory.set(n.id))}),j(1,"i"),M()}if(o&2){let e=t.$implicit,i=s();w(i.activeCategory()===e.id?"text-telegram-primary bg-telegram-primary/10":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"),a(),w("ph "+e.icon)}}function Qe(o,t){if(o&1){let e=k();b(0,"button",11),F("click",function(){let n=p(e).$implicit,r=s(2);return u(r.selectEmoji(n))}),m(1),M()}if(o&2){let e=t.$implicit;a(),R(" ",e," ")}}function Ye(o,t){if(o&1&&(b(0,"div",8),V(1,Qe,2,1,"button",10,O),M()),o&2){let e=s();a(),A(e.filteredEmojis())}}function Ke(o,t){if(o&1){let e=k();b(0,"button",11),F("click",function(){let n=p(e).$implicit,r=s(3);return u(r.selectEmoji(n))}),m(1),M()}if(o&2){let e=t.$implicit;a(),R(" ",e," ")}}function Je(o,t){if(o&1&&(b(0,"div",12),m(1,"Recently Used"),M(),b(2,"div",8),V(3,Ke,2,1,"button",10,O),M()),o&2){let e=s(2);a(3),A(e.recentEmojis())}}function We(o,t){if(o&1){let e=k();b(0,"button",11),F("click",function(){let n=p(e).$implicit,r=s(3);return u(r.selectEmoji(n))}),m(1),M()}if(o&2){let e=t.$implicit;a(),R(" ",e," ")}}function Ze(o,t){if(o&1&&(b(0,"div",8),V(1,We,2,1,"button",10,O),M()),o&2){let e=s(2);a(),A(e.currentCategoryEmojis())}}function et(o,t){if(o&1&&v(0,Je,5,0)(1,Ze,3,0,"div",8),o&2){let e=s();C(e.activeCategory()==="recent"?0:1)}}var tt=[{id:"recent",label:"Recent",icon:"ph-clock"},{id:"smileys",label:"Smileys",icon:"ph-smiley"},{id:"hearts",label:"Hearts",icon:"ph-heart"},{id:"hands",label:"Hands",icon:"ph-hand-waving"},{id:"animals",label:"Animals",icon:"ph-cat"},{id:"food",label:"Food",icon:"ph-hamburger"},{id:"objects",label:"Objects",icon:"ph-lightbulb"},{id:"symbols",label:"Symbols",icon:"ph-star"}],je={smileys:["\u{1F600}","\u{1F603}","\u{1F604}","\u{1F601}","\u{1F606}","\u{1F605}","\u{1F923}","\u{1F602}","\u{1F642}","\u{1F60A}","\u{1F607}","\u{1F970}","\u{1F60D}","\u{1F929}","\u{1F618}","\u{1F617}","\u{1F61A}","\u{1F619}","\u{1F972}","\u{1F60B}","\u{1F61B}","\u{1F61C}","\u{1F92A}","\u{1F61D}","\u{1F911}","\u{1F917}","\u{1F92D}","\u{1FAE2}","\u{1F92B}","\u{1F914}","\u{1FAE1}","\u{1F910}","\u{1F928}","\u{1F610}","\u{1F611}","\u{1F636}","\u{1FAE0}","\u{1F60F}","\u{1F612}","\u{1F644}","\u{1F62C}","\u{1F925}","\u{1F60C}","\u{1F614}","\u{1F62A}","\u{1F924}","\u{1F634}","\u{1F637}","\u{1F912}","\u{1F915}","\u{1F922}","\u{1F92E}","\u{1F975}","\u{1F976}","\u{1F974}","\u{1F635}","\u{1F92F}","\u{1F920}","\u{1F973}","\u{1F978}","\u{1F60E}","\u{1F913}","\u{1F9D0}","\u{1F615}","\u{1FAE4}","\u{1F61F}","\u{1F641}","\u{1F62E}","\u{1F62F}","\u{1F632}","\u{1F633}","\u{1F97A}","\u{1F979}","\u{1F626}","\u{1F627}","\u{1F628}","\u{1F630}","\u{1F625}","\u{1F622}","\u{1F62D}","\u{1F631}","\u{1F616}","\u{1F623}","\u{1F61E}","\u{1F613}","\u{1F629}","\u{1F62B}","\u{1F971}"],hearts:["\u2764\uFE0F","\u{1F9E1}","\u{1F49B}","\u{1F49A}","\u{1F499}","\u{1F49C}","\u{1F5A4}","\u{1F90D}","\u{1F90E}","\u{1F494}","\u2764\uFE0F\u200D\u{1F525}","\u2764\uFE0F\u200D\u{1FA79}","\u{1F495}","\u{1F49E}","\u{1F493}","\u{1F497}","\u{1F496}","\u{1F498}","\u{1F49D}","\u{1F49F}","\u2665\uFE0F","\u{1FAF6}","\u{1FAC0}","\u{1F491}","\u{1F48F}","\u{1F60D}","\u{1F970}","\u{1F618}","\u{1F63B}","\u{1F48C}"],hands:["\u{1F44B}","\u{1F91A}","\u{1F590}\uFE0F","\u270B","\u{1F596}","\u{1FAF1}","\u{1FAF2}","\u{1FAF3}","\u{1FAF4}","\u{1F44C}","\u{1F90C}","\u{1F90F}","\u270C\uFE0F","\u{1F91E}","\u{1FAF0}","\u{1F91F}","\u{1F918}","\u{1F919}","\u{1F448}","\u{1F449}","\u{1F446}","\u{1F595}","\u{1F447}","\u261D\uFE0F","\u{1FAF5}","\u{1F44D}","\u{1F44E}","\u270A","\u{1F44A}","\u{1F91B}","\u{1F91C}","\u{1F44F}","\u{1F64C}","\u{1FAF6}","\u{1F450}","\u{1F932}","\u{1F91D}","\u{1F64F}","\u270D\uFE0F","\u{1F4AA}","\u{1FAF5}"],animals:["\u{1F436}","\u{1F431}","\u{1F42D}","\u{1F439}","\u{1F430}","\u{1F98A}","\u{1F43B}","\u{1F43C}","\u{1F43B}\u200D\u2744\uFE0F","\u{1F428}","\u{1F42F}","\u{1F981}","\u{1F42E}","\u{1F437}","\u{1F438}","\u{1F435}","\u{1F648}","\u{1F649}","\u{1F64A}","\u{1F412}","\u{1F414}","\u{1F427}","\u{1F426}","\u{1F424}","\u{1F423}","\u{1F425}","\u{1F986}","\u{1F985}","\u{1F989}","\u{1F987}","\u{1F43A}","\u{1F417}","\u{1F434}","\u{1F984}","\u{1F41D}","\u{1F41B}","\u{1F98B}","\u{1F40C}","\u{1F41E}","\u{1F41C}","\u{1FAB2}","\u{1F422}","\u{1F40D}"],food:["\u{1F34E}","\u{1F350}","\u{1F34A}","\u{1F34B}","\u{1F34C}","\u{1F349}","\u{1F347}","\u{1F353}","\u{1FAD0}","\u{1F348}","\u{1F352}","\u{1F351}","\u{1F96D}","\u{1F34D}","\u{1F965}","\u{1F95D}","\u{1F345}","\u{1F346}","\u{1F951}","\u{1F966}","\u{1F96C}","\u{1F952}","\u{1F336}\uFE0F","\u{1FAD1}","\u{1F33D}","\u{1F955}","\u{1FAD2}","\u{1F9C4}","\u{1F9C5}","\u{1F954}","\u{1F360}","\u{1F950}","\u{1F96F}","\u{1F35E}","\u{1F956}","\u{1F968}","\u{1F9C0}","\u{1F95A}","\u{1F373}","\u{1F95E}","\u{1F9C7}","\u{1F953}","\u{1F969}","\u{1F357}","\u{1F356}","\u{1F32D}","\u{1F354}","\u{1F35F}","\u{1F355}","\u{1FAD3}","\u{1F96A}"],objects:["\u231A","\u{1F4F1}","\u{1F4BB}","\u2328\uFE0F","\u{1F5A5}\uFE0F","\u{1F5A8}\uFE0F","\u{1F5B1}\uFE0F","\u{1F5B2}\uFE0F","\u{1F579}\uFE0F","\u{1F5DC}\uFE0F","\u{1F4BE}","\u{1F4BF}","\u{1F4C0}","\u{1F4FC}","\u{1F4F7}","\u{1F4F8}","\u{1F4F9}","\u{1F3A5}","\u{1F4FD}\uFE0F","\u{1F39E}\uFE0F","\u{1F4DE}","\u260E\uFE0F","\u{1F4DF}","\u{1F4E0}","\u{1F4FA}","\u{1F4FB}","\u{1F399}\uFE0F","\u{1F39A}\uFE0F","\u{1F39B}\uFE0F","\u{1F9ED}","\u23F1\uFE0F","\u23F2\uFE0F","\u23F0","\u{1F570}\uFE0F","\u{1F4A1}","\u{1F526}","\u{1F56F}\uFE0F","\u{1FA94}","\u{1F9EF}","\u{1F6E2}\uFE0F","\u{1F4B8}","\u{1F4B5}","\u{1F4B4}","\u{1F4B6}","\u{1F4B7}","\u{1FA99}","\u{1F4B0}","\u{1F4B3}"],symbols:["\u2764\uFE0F","\u{1F525}","\u2B50","\u2728","\u{1F4AB}","\u{1F31F}","\u{1F4AF}","\u2705","\u274C","\u26A1","\u{1F4A5}","\u{1F4A2}","\u{1F4A4}","\u{1F4A8}","\u{1F3B5}","\u{1F3B6}","\u{1F511}","\u{1F512}","\u{1F513}","\u{1F3F3}\uFE0F","\u{1F3F4}","\u{1F6A9}","\u{1F38C}","\u{1F3C1}","\u267B\uFE0F","\u{1F4A0}","\u{1F530}","\u269C\uFE0F","\u{1F531}","\u{1F4DB}","\u{1F534}","\u{1F7E0}","\u{1F7E1}","\u{1F7E2}","\u{1F535}","\u{1F7E3}","\u26AB","\u26AA","\u{1F7E4}","\u{1F536}","\u{1F537}","\u{1F538}","\u{1F539}","\u{1F53A}","\u{1F53B}"]},it=Object.values(je).flat(),re=class o{constructor(){this.emojiSelected=Ce();this.categories=tt;this.activeCategory=E("smileys");this.searchQuery=E("");this.recentEmojis=E(["\u{1F600}","\u2764\uFE0F","\u{1F44D}","\u{1F525}","\u{1F602}","\u{1F389}","\u2728","\u{1F64F}","\u{1F60D}","\u{1F4AF}"]);this.filteredEmojis=U(()=>this.searchQuery()?it:[]);this.currentCategoryEmojis=U(()=>je[this.activeCategory()]||[])}onSearch(t){this.searchQuery.set(t.target.value)}selectEmoji(t){this.recentEmojis.update(e=>[t,...e.filter(i=>i!==t)].slice(0,30)),this.emojiSelected.emit(t)}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=$({type:o,selectors:[["app-emoji-picker"]],outputs:{emojiSelected:"emojiSelected"},decls:11,vars:1,consts:[[1,"flex","flex-col","bg-white","dark:bg-telegram-surface","rounded-2xl","shadow-2xl","border","border-gray-200","dark:border-gray-700/50","overflow-hidden","w-full","max-w-[360px]","min-w-[280px]",2,"height","380px",3,"click"],[1,"px-3","pt-3","pb-2"],[1,"relative"],[1,"ph","ph-magnifying-glass","absolute","left-2.5","top-1/2","-translate-y-1/2","text-gray-400","text-sm"],["type","text","placeholder","Search emoji...",1,"w-full","bg-gray-100","dark:bg-gray-800","text-sm","rounded-lg","py-1.5","pl-8","pr-3","outline-none","text-black","dark:text-white","placeholder-gray-400",3,"input"],[1,"flex","px-2","gap-0.5","border-b","border-gray-100","dark:border-gray-700/50"],[1,"flex-1","py-1.5","flex","justify-center","items-center","rounded-t-lg","transition-colors","text-sm",3,"class"],[1,"flex-1","overflow-y-auto","no-scrollbar","p-2"],[1,"grid","grid-cols-8","gap-0.5"],[1,"flex-1","py-1.5","flex","justify-center","items-center","rounded-t-lg","transition-colors","text-sm",3,"click"],[1,"w-9","h-9","flex","items-center","justify-center","text-xl","rounded-lg","hover:bg-gray-100","dark:hover:bg-gray-700","transition-colors","active:scale-90"],[1,"w-9","h-9","flex","items-center","justify-center","text-xl","rounded-lg","hover:bg-gray-100","dark:hover:bg-gray-700","transition-colors","active:scale-90",3,"click"],[1,"text-xs","text-gray-400","px-1","pb-1","font-medium"]],template:function(e,i){e&1&&(b(0,"div",0),F("click",function(r){return r.stopPropagation()}),b(1,"div",1)(2,"div",2),j(3,"i",3),b(4,"input",4),F("input",function(r){return i.onSearch(r)}),M()()(),b(5,"div",5),V(6,qe,2,4,"button",6,Xe),M(),b(8,"div",7),v(9,Ye,3,0,"div",8)(10,et,2,1),M()()),e&2&&(a(6),A(i.categories),a(3),C(i.searchQuery()?9:10))},encapsulation:2})}};var ae=class o{static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=$({type:o,selectors:[["app-typing-indicator"]],decls:6,vars:0,consts:[[1,"flex","items-end","gap-1","self-start","max-w-[80%]"],[1,"px-4","py-3","rounded-2xl","rounded-bl-sm","bg-white","dark:bg-telegram-surface","border","border-gray-100","dark:border-gray-800","shadow-sm"],[1,"flex","items-center","gap-1.5","h-4"],[1,"w-2","h-2","rounded-full","bg-gray-400","dark:bg-gray-500","animate-typing-dot-1"],[1,"w-2","h-2","rounded-full","bg-gray-400","dark:bg-gray-500","animate-typing-dot-2"],[1,"w-2","h-2","rounded-full","bg-gray-400","dark:bg-gray-500","animate-typing-dot-3"]],template:function(e,i){e&1&&(b(0,"div",0)(1,"div",1)(2,"div",2),j(3,"span",3)(4,"span",4)(5,"span",5),M()()())},encapsulation:2})}};var le=class o{constructor(){this.label=X.required()}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=$({type:o,selectors:[["app-date-separator"]],inputs:{label:[1,"label"]},decls:3,vars:1,consts:[[1,"flex","items-center","justify-center","py-2","sticky","top-0","z-10"],[1,"px-3","py-1","rounded-full","text-xs","font-medium","bg-black/10","dark:bg-white/10","text-gray-600","dark:text-gray-300","backdrop-blur-md","shadow-sm"]],template:function(e,i){e&1&&(b(0,"div",0)(1,"div",1),m(2),M()()),e&2&&(a(2),R(" ",i.label()," "))},encapsulation:2})}};var nt=["messagesContainer"],ot=["messageInput"],rt=["sendBtn"],at=["micBtn"],lt=["peerProfileTrigger"],st=["galleryInput"],ct=["fileInput"],dt=(o,t)=>t.key,Be=(o,t)=>t.id,Le=(o,t)=>t.emoji;function mt(o,t){o&1&&(l(0,"div",10)(1,"div",42),h(2,"i",43),l(3,"div",44),m(4,"Drop files to attach"),c(),l(5,"div",45),m(6,"Image, video, audio, or document"),c()()())}function pt(o,t){o&1&&(l(0,"div",15),h(1,"i",46),c())}function ut(o,t){if(o&1&&h(0,"app-avatar",16),o&2){let e,i,n,r=s();P("src",((e=r.chat())==null?null:e.type)==="direct"?(e=r.participant())==null?null:e.avatarUrl:(e=r.chat())==null?null:e.avatarUrl)("name",((i=r.chat())==null?null:i.type)==="direct"?((i=r.participant())==null?null:i.name)||"":((i=r.chat())==null?null:i.name)||"")("isOnline",((n=r.participant())==null?null:n.isOnline)||!1)}}function gt(o,t){if(o&1&&(l(0,"span",19,4),m(2),c()),o&2){let e=s();a(2),R(" ",e.statusString()," ")}}function ht(o,t){if(o&1&&h(0,"app-date-separator",47),o&2){let e=s().$implicit;P("label",e.dateLabel)}}function ft(o,t){if(o&1){let e=k();l(0,"div",59),_("click",function(){p(e),s(2);let n=y(0),r=s(2);return u(r.scrollToMessage(n.replyToId))}),h(1,"div",60),l(2,"div",61)(3,"div",62),m(4),c(),l(5,"div",63),m(6),c()()()}if(o&2){let e;s();let i=y(0);s();let n=y(1),r=s(2);w(n?"bg-white/10":"bg-telegram-primary/10"),a(),w(n?"bg-white/50":"bg-telegram-primary"),a(2),w(n?"text-white/80":"text-telegram-primary"),a(),R(" ",((e=r.chatService.getUserById(i.senderId))==null?null:e.name)||"User"," "),a(2),S(i.text==null?null:i.text.substring(0,50))}}function xt(o,t){if(o&1&&(J(0),v(1,ft,7,8,"div",58)),o&2){s();let e=y(0),i=G(s(2).chatService.getMessageById(e.replyToId));a(),C(i?1:-1)}}function _t(o,t){if(o&1&&(l(0,"div",51),m(1),c()),o&2){let e;s();let i=y(0),n=s(2);a(),R(" ",(e=n.chatService.getUserById(i.senderId))==null?null:e.name," ")}}function vt(o,t){if(o&1&&h(0,"app-voice-player",52),o&2){s();let e=y(0),i=y(1);P("audioUrl",e.voice.url)("durationMs",e.voice.durationMs)("waveform",e.voice.waveform)("isMine",i)}}function Ct(o,t){if(o&1){let e=k();l(0,"div",67)(1,"img",68),_("click",function(n){p(e);let r=s().$implicit,d=s(4);return u(d.openAttachment(r,n))}),c()()}if(o&2){let e=s().$implicit;s(2);let i=y(1);w(i?"border-white/10":"border-gray-200 dark:border-gray-700"),a(),P("src",e.url,Z)("alt",e.name||"Image")}}function yt(o,t){if(o&1){let e=k();l(0,"div",67)(1,"video",69),h(2,"source",70),c(),l(3,"button",71),_("click",function(n){p(e);let r=s().$implicit,d=s(4);return u(d.openAttachment(r,n))}),l(4,"div",72),h(5,"i",73),c(),l(6,"div",74)(7,"div",75),m(8),c(),l(9,"div",76),m(10),c()(),h(11,"i",77),c()()}if(o&2){let e=s().$implicit;s(2);let i=y(1),n=s(2);w(i?"border-white/10":"border-gray-200 dark:border-gray-700"),a(2),P("src",e.url),a(6),S(n.attachmentDisplayName(e)),a(),w(i?"text-white/70":"text-telegram-muted"),a(),S(n.attachmentMeta(e))}}function bt(o,t){if(o&1&&(l(0,"div",78)(1,"div",79)(2,"div",72),h(3,"i",80),c(),l(4,"div",61)(5,"div",75),m(6),c(),l(7,"div",76),m(8),c()()(),h(9,"audio",81),c()),o&2){let e=s().$implicit;s(2);let i=y(1),n=s(2);w(i?"border-white/10 bg-white/10":"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800"),a(6),S(n.attachmentDisplayName(e)),a(),w(i?"text-white/70":"text-telegram-muted"),a(),S(n.attachmentMeta(e)),a(),P("src",e.url)}}function wt(o,t){if(o&1){let e=k();l(0,"button",82),_("click",function(n){p(e);let r=s().$implicit,d=s(4);return u(d.openAttachment(r,n))}),l(1,"div",72),h(2,"i"),c(),l(3,"div",74)(4,"div",75),m(5),c(),l(6,"div",76),m(7),c()(),h(8,"i",83),c()}if(o&2){let e=s().$implicit;s(2);let i=y(1),n=s(2);w(i?"border-white/10 bg-white/10":"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800"),a(2),w(n.attachmentIcon(e)+" text-base"),a(3),S(n.attachmentDisplayName(e)),a(),w(i?"text-white/70":"text-telegram-muted"),a(),S(n.attachmentMeta(e))}}function kt(o,t){if(o&1&&v(0,Ct,2,4,"div",64)(1,yt,12,7,"div",64)(2,bt,10,7,"div",65)(3,wt,9,8,"button",66),o&2){let e=t.$implicit;C(e.type==="image"?0:e.type==="video"?1:e.type==="audio"?2:3)}}function Et(o,t){if(o&1&&(l(0,"div",53),V(1,kt,4,1,null,null,Be),c()),o&2){s();let e=y(0);a(),A(e.attachments)}}function St(o,t){if(o&1&&(l(0,"p",54),m(1),c()),o&2){s();let e=y(0);P("id","text-"+e.id),a(),S(e.text)}}function Tt(o,t){o&1&&h(0,"i",84)}function Mt(o,t){o&1&&h(0,"i",85)}function It(o,t){o&1&&h(0,"i",86)}function Rt(o,t){o&1&&h(0,"i",87)}function Pt(o,t){if(o&1&&v(0,Tt,1,0,"i",84)(1,Mt,1,0,"i",85)(2,It,1,0,"i",86)(3,Rt,1,0,"i",87),o&2){s();let e=y(0);C(e.status==="sending"?0:e.status==="sent"?1:e.status==="delivered"?2:e.status==="seen"?3:-1)}}function Vt(o,t){if(o&1){let e=k();l(0,"button",90),_("click",function(n){let r=p(e).$implicit;s(2);let d=y(0),g=s(2);return u(g.toggleReaction(d.id,r.emoji,n))}),l(1,"span"),m(2),c(),l(3,"span",91),m(4),c()()}if(o&2){let e=t.$implicit,i=s(4);w(e.userIds.includes(i.chatService.currentUser().id)?"bg-telegram-primary/20 border-telegram-primary/40 text-telegram-primary":"bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700"),a(2),S(e.emoji),a(2),S(e.userIds.length)}}function At(o,t){if(o&1&&(l(0,"div",88),V(1,Vt,5,4,"button",89,Le),c()),o&2){s();let e=y(0),i=y(1);K("self-end",i)("self-start",!i),a(),A(e.reactions)}}function Dt(o,t){if(o&1){let e=k();J(0)(1),l(2,"div",49),_("touchstart",function(n){p(e);let r=y(0),d=s(2);return u(d.onTouchStart(n,r))})("touchmove",function(n){p(e);let r=y(0),d=s(2);return u(d.onTouchMove(n,r))})("touchend",function(n){p(e);let r=y(0),d=s(2);return u(d.onTouchEnd(n,r))})("contextmenu",function(n){p(e);let r=y(0),d=s(2);return u(d.onContextMenu(n,r))}),v(3,xt,2,2),l(4,"div",50),v(5,_t,2,1,"div",51),v(6,vt,1,4,"app-voice-player",52),v(7,Et,3,0,"div",53),v(8,St,2,2,"p",54),l(9,"div",55)(10,"span",56),m(11),pe(12,"shortTime"),c(),v(13,Pt,4,1),c()(),v(14,At,3,4,"div",57),c()}if(o&2){let e,i,n,r=s().$implicit,d=s(),g=G(r.message);a();let f=G(((e=d.chat())==null?null:e.type)==="saved"?!0:g.senderId===d.chatService.currentUser().id),T=((i=d.chat())==null?null:i.type)==="saved",x=r.showTail,D=r.isGrouped;a(),Y("transform",d.swipingMsgId()===g.id?"translateX("+d.swipeX()+"px)":"translateX(0px)")("opacity",g.isAnimating?"0":"1"),K("self-end",f)("self-start",!f)("max-w-[80%]",!0)("mt-0",D)("mt-2",!D),P("id","msg-"+g.id),a(),C(g.replyToId?3:-1),a(),w(f?"bg-telegram-primary text-white "+(x?"rounded-2xl rounded-br-sm":"rounded-2xl"):"bg-white dark:bg-telegram-surface text-black dark:text-white "+(x?"rounded-2xl rounded-bl-sm":"rounded-2xl")+" border border-gray-100 dark:border-gray-800/50"),a(),C(!f&&!T&&(((n=d.chat())==null?null:n.type)==="group"||((n=d.chat())==null?null:n.type)==="channel")&&!D?5:-1),a(),C(g.voice?6:-1),a(),C(g.attachments&&g.attachments.length>0?7:-1),a(),C(g.text?8:-1),a(),w(f?"text-white/60":"text-telegram-muted"),a(2),S(ue(12,29,g.timestamp)),a(2),C(f&&!T?13:-1),a(),C(g.reactions&&g.reactions.length>0?14:-1)}}function jt(o,t){if(o&1&&v(0,ht,1,1,"app-date-separator",47)(1,Dt,15,31,"div",48),o&2){let e=t.$implicit;C(e.type==="date"?0:e.type==="message"?1:-1)}}function Ft(o,t){o&1&&h(0,"app-typing-indicator")}function Bt(o,t){if(o&1){let e=k();l(0,"button",92),_("click",function(){p(e);let n=s();return u(n.scrollToBottom())}),h(1,"i",93),c()}}function Lt(o,t){if(o&1&&(l(0,"div",51),m(1),c()),o&2){let e;s();let i=y(0),n=s();a(),R(" ",(e=n.chatService.getUserById(i.senderId))==null?null:e.name," ")}}function Ut(o,t){if(o&1&&h(0,"app-voice-player",52),o&2){s();let e=y(0),i=y(1);P("audioUrl",e.voice.url)("durationMs",e.voice.durationMs)("waveform",e.voice.waveform)("isMine",i)}}function $t(o,t){if(o&1&&(l(0,"p",98),m(1),c()),o&2){s();let e=y(0);a(),S(e.text)}}function Nt(o,t){if(o&1&&(l(0,"span",110)(1,"span"),m(2),c(),l(3,"span",91),m(4),c()()),o&2){let e=t.$implicit,i=s(3);w(e.userIds.includes(i.chatService.currentUser().id)?"bg-telegram-primary/20 border-telegram-primary/40 text-telegram-primary":"bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700"),a(2),S(e.emoji),a(2),S(e.userIds.length)}}function zt(o,t){if(o&1&&(l(0,"div",88),V(1,Nt,5,4,"span",109,Le),c()),o&2){s();let e=y(0);a(),A(e.reactions)}}function Ht(o,t){if(o&1){let e=k();l(0,"button",111),_("click",function(){let n=p(e).$implicit,r=s(2);return u(r.onContextReaction(n))}),m(1),c()}if(o&2){let e=t.$implicit;a(),R(" ",e," ")}}function Ot(o,t){if(o&1){let e=k();J(0)(1),l(2,"div",94),_("click",function(){p(e);let n=s();return u(n.closeContextPreview())}),l(3,"div",95),_("click",function(n){return p(e),u(n.stopPropagation())}),l(4,"div",96)(5,"div",97),v(6,Lt,2,1,"div",51),v(7,Ut,1,4,"app-voice-player",52),v(8,$t,2,1,"p",98),l(9,"div",55)(10,"span",56),m(11),pe(12,"shortTime"),c()()(),v(13,zt,3,0,"div",88),c(),l(14,"div",99),V(15,Ht,2,1,"button",100,_e),c(),l(17,"div",101)(18,"div",102)(19,"button",103),_("click",function(){p(e);let n=s();return u(n.onContextAction("reply"))}),h(20,"i",104),l(21,"span"),m(22,"Reply"),c()(),l(23,"button",103),_("click",function(){p(e);let n=s();return u(n.onContextAction("forward"))}),h(24,"i",105),l(25,"span"),m(26,"Forward"),c()(),l(27,"button",103),_("click",function(){p(e);let n=s();return u(n.onContextAction("copy"))}),h(28,"i",106),l(29,"span"),m(30,"Copy"),c()(),l(31,"button",107),_("click",function(){p(e);let n=s();return u(n.onContextAction("delete"))}),h(32,"i",108),l(33,"span"),m(34,"Delete"),c()()()()()()}if(o&2){let e,i,n=s(),r=G(n.contextMenuMsg());a();let d=G(((e=n.chat())==null?null:e.type)==="saved"?!0:r.senderId===n.chatService.currentUser().id);a(4),w(d?"bg-telegram-primary text-white rounded-2xl rounded-br-sm":"bg-white dark:bg-telegram-surface text-black dark:text-white rounded-2xl rounded-bl-sm border border-gray-100 dark:border-gray-800/50"),a(),C(!d&&(((i=n.chat())==null?null:i.type)==="group"||((i=n.chat())==null?null:i.type)==="channel")?6:-1),a(),C(r.voice?7:-1),a(),C(r.text?8:-1),a(),w(d?"text-white/60":"text-telegram-muted"),a(2),S(ue(12,11,r.timestamp)),a(2),C(r.reactions&&r.reactions.length>0?13:-1),a(2),A(n.contextReactionEmojis)}}function Gt(o,t){if(o&1&&h(0,"img",121),o&2){s();let e=y(0);P("src",e.avatarUrl,Z)}}function Xt(o,t){if(o&1&&(l(0,"div",122),m(1),c()),o&2){s();let e=y(0),i=s();a(),R(" ",i.profileInitial(e.name)," ")}}function qt(o,t){if(o&1){let e=k();J(0),l(1,"div",112),_("click",function(){p(e);let n=s();return u(n.closePeerProfileCard())}),l(2,"div",113),_("click",function(n){return p(e),u(n.stopPropagation())}),l(3,"div",114)(4,"div",115)(5,"span",116),m(6,"Profile"),c(),l(7,"button",117),_("click",function(){p(e);let n=s();return u(n.closePeerProfileCard())}),h(8,"i",118),c()(),l(9,"div",119)(10,"div",120),v(11,Gt,1,1,"img",121)(12,Xt,2,1,"div",122),c(),l(13,"div",123)(14,"div",62),m(15),c(),l(16,"div",124),m(17),c()()(),l(18,"div",125)(19,"span",126),m(20,"Name"),c(),l(21,"div",127),m(22),c()(),l(23,"div",125)(24,"span",126),m(25,"Username"),c(),l(26,"div",128),m(27),c()(),l(28,"div",125)(29,"span",126),m(30,"Bio"),c(),l(31,"p",129),m(32),c()()()()()}if(o&2){let e=G(s().peerProfile());a(11),C(e.avatarUrl?11:12),a(4),S(e.name),a(2),S(e.status),a(5),S(e.name),a(5),S("@"+e.username),a(5),S(e.bio)}}function Qt(o,t){if(o&1){let e=k();l(0,"div",130)(1,"app-emoji-picker",131),_("emojiSelected",function(n){p(e);let r=s();return u(r.onEmojiSelected(n))}),c()(),l(2,"div",132),_("click",function(){p(e);let n=s();return u(n.showEmojiPicker.set(!1))}),c()}}function Yt(o,t){if(o&1){let e=k();l(0,"div",26),h(1,"div",133),l(2,"div",74)(3,"div",134),m(4),c(),l(5,"div",135),m(6),c()(),l(7,"button",136),_("click",function(){p(e);let n=s();return u(n.cancelReply())}),h(8,"i",118),c()()}if(o&2){let e,i,n=s();a(4),S((e=n.chatService.getUserById(n.replyingTo().senderId))==null?null:e.name),a(2),S(((i=n.replyingTo().text)==null?null:i.substring(0,60))||"Voice message")}}function Kt(o,t){if(o&1){let e=k();l(0,"div",27),h(1,"div",137),l(2,"div",138)(3,"button",139),_("click",function(){p(e);let n=s();return u(n.openGalleryPicker())}),l(4,"div",140),h(5,"i",141),c(),l(6,"span",142),m(7,"Gallery"),c()(),l(8,"button",139),_("click",function(){p(e);let n=s();return u(n.openFilePicker())}),l(9,"div",143),h(10,"i",144),c(),l(11,"span",142),m(12,"File"),c()(),l(13,"button",139),_("click",function(){p(e);let n=s();return u(n.shareCurrentLocation())}),l(14,"div",145),h(15,"i",146),c(),l(16,"span",142),m(17,"Location"),c()(),l(18,"button",139),_("click",function(){p(e);let n=s();return u(n.toggleAttachmentPanel())}),l(19,"div",147),h(20,"i",148),c(),l(21,"span",142),m(22,"Cancel"),c()()()()}}function Jt(o,t){o&1&&m(0," Uploading... ")}function Wt(o,t){if(o&1&&m(0),o&2){let e=s(2);R(" ",e.pendingAttachments().length," file(s) ready ")}}function Zt(o,t){if(o&1&&h(0,"img",154),o&2){let e=s().$implicit;P("src",e.url,Z)("alt",e.name||"Attachment")}}function ei(o,t){if(o&1&&(l(0,"div",155),h(1,"i"),c()),o&2){let e=s().$implicit,i=s(2);a(),w(i.attachmentIcon(e)+" text-xl")}}function ti(o,t){if(o&1){let e=k();l(0,"div",153),v(1,Zt,1,2,"img",154)(2,ei,2,2,"div",155),l(3,"button",156),_("click",function(n){let r=p(e).$implicit,d=s(2);return u(d.removePendingAttachment(r.id,n))}),h(4,"i",148),c()()}if(o&2){let e=t.$implicit,i=s(2);a(),C(e.type==="image"?1:2),a(2),P("disabled",i.isUploadingAttachments())}}function ii(o,t){if(o&1){let e=k();l(0,"div",149)(1,"div",150)(2,"span",126),v(3,Jt,1,0)(4,Wt,1,1),c(),l(5,"button",151),_("click",function(){p(e);let n=s();return u(n.clearPendingAttachments())}),m(6," Clear "),c()(),l(7,"div",152),V(8,ti,5,2,"div",153,Be),c()()}if(o&2){let e=s();Y("bottom",e.replyingTo()?"6.3rem":"4.55rem"),a(3),C(e.isUploadingAttachments()?3:4),a(2),P("disabled",e.isUploadingAttachments()),a(3),A(e.pendingAttachments())}}function ni(o,t){if(o&1&&(l(0,"div",36)(1,"div",157),h(2,"div",158),l(3,"span",159),m(4),c()(),l(5,"span",126),m(6,"\u2190 Slide to cancel"),c()()),o&2){let e=s();a(4),S(e.formatDuration(e.voiceRecorder.recordingDuration()))}}function oi(o,t){if(o&1){let e=k();l(0,"textarea",160,5),_("ngModelChange",function(n){p(e);let r=s();return u(r.onInputTextChange(n))})("input",function(n){p(e);let r=s();return u(r.autoGrow(n))})("keydown.enter",function(n){p(e);let r=s();return u(r.handleEnter(n))}),c()}if(o&2){let e=s();P("ngModel",e.inputText())}}function ri(o,t){if(o&1){let e=k();l(0,"div",41)(1,"button",161),_("click",function(){p(e);let n=s();return u(n.cancelRecording())}),h(2,"i",162),c(),l(3,"button",163),_("click",function(){p(e);let n=s();return u(n.stopAndSendRecording())}),h(4,"i",164),c()()}}function ai(o,t){if(o&1){let e=k();l(0,"button",165,6),_("click",function(){p(e);let n=s();return u(n.initiateSendMessage())}),h(2,"i",164),c(),l(3,"button",166,7),_("click",function(){p(e);let n=s();return u(n.startRecording())}),h(5,"i",167),c()}if(o&2){let e=s();P("disabled",e.isUploadingAttachments())}}var li=["\u2764\uFE0F","\u{1F44D}","\u{1F602}","\u{1F62E}","\u{1F622}","\u{1F64F}"],Fe=class o{constructor(){this.chatService=L(Me);this.api=L(Ee);this.voiceRecorder=L(ie);this.animationService=L(we);this.audioService=L(Te);this.themeService=L(ke);this.route=L(ye);this.router=L(be);this.messagesContainer=B("messagesContainer");this.messageInput=B("messageInput");this.sendBtn=B("sendBtn");this.micBtn=B("micBtn");this.peerProfileTrigger=B("peerProfileTrigger");this.galleryInput=B("galleryInput");this.fileInput=B("fileInput");this.chatId="";this.inputText=E("");this.hasText=E(!1);this.showEmojiPicker=E(!1);this.showScrollBtn=E(!1);this.showAttachmentPanel=E(!1);this.replyingTo=E(null);this.pendingAttachments=E([]);this.isDraggingFiles=E(!1);this.isUploadingAttachments=E(!1);this.transientAttachmentUrls=new Set;this.pendingAttachmentFiles=new Map;this.contextMenuMsg=E(null);this.contextReactionEmojis=li;this.isClosingContextPreview=!1;this.showPeerProfileCard=E(!1);this.isClosingPeerProfileCard=!1;this.Math=Math;this.swipingMsgId=E(null);this.swipeX=E(0);this.swipeStartX=0;this.swipeStartY=0;this.swipeDirectionLocked=null;this.scrollRafId=null;this.chat=U(()=>this.chatService.getChatById(this.chatId));this.participant=U(()=>{let t=this.chat();return t?this.chatService.getParticipant(t):void 0});this.messages=U(()=>this.chatService.getMessagesForChat(this.chatId)());this.isTyping=U(()=>this.chatService.getTypingUsersForChat(this.chatId).length>0);this.statusString=U(()=>{let t=this.chat();if(!t||t.type==="saved")return"";let e=this.chatService.getTypingUsersForChat(this.chatId);return e.length>0?t.type==="direct"?"typing...":e.map(n=>this.chatService.getUserById(n)?.name?.split(" ")[0]).filter(Boolean).join(", ")+" typing...":t.type==="group"?`${t.memberCount||t.participants.length} members`:t.type==="channel"?`${t.memberCount?.toLocaleString()} subscribers`:this.participant()?.isOnline?"online":"last seen recently"});this.peerProfile=U(()=>{let t=this.chat();if(!t||t.type==="saved")return null;if(t.type==="direct"){let n=this.participant();return n?{name:n.name||"User",username:this.normalizeProfileHandle(n.username||n.name||"user"),bio:n.bio||"No bio yet",avatarUrl:n.avatarUrl,status:n.isOnline?"online":"last seen recently"}:null}let e=t.memberCount||t.participants.length,i=t.type==="group"?`${e} members`:`${t.memberCount?.toLocaleString()||0} subscribers`;return{name:t.name||"Chat",username:this.normalizeProfileHandle(t.name||t.id||"chat"),bio:t.description||i,avatarUrl:t.avatarUrl,status:i}});this.displayItems=U(()=>{let t=this.messages(),e=[],i="",n="";for(let r=0;r<t.length;r++){let d=t[r],g=this.getDateLabel(d.timestamp);g!==i&&(e.push({type:"date",key:"date-"+g,dateLabel:g}),i=g,n="");let f=d.senderId===n,T=t[r+1],x=!T||T.senderId!==d.senderId||this.getDateLabel(T.timestamp)!==g;e.push({type:"message",key:d.id,message:d,isGrouped:f,showTail:x}),n=d.senderId}return e});this.messageCount=0;this.scrollHandler=()=>{this.scrollRafId||(this.scrollRafId=requestAnimationFrame(()=>{this.scrollRafId=null;let t=this.messagesContainer()?.nativeElement;if(!t)return;let e=t.scrollHeight-t.scrollTop-t.clientHeight;this.showScrollBtn.set(e>200)}))};this.routeSub=this.route.params.subscribe(t=>{this.chatId=t.id,this.chatService.markAsRead(this.chatId),xe(()=>{this.scrollToBottom(),this.animationService.pageTransitionIn("#chat-room-container"),this.messageCount=this.messages().length,this.attachScrollListener()})}),de(()=>{let t=this.hasText()||this.pendingAttachments().length>0,e=this.sendBtn()?.nativeElement,i=this.micBtn()?.nativeElement;e&&i&&(this.animationService.toggleActionButtons(t,e,i),e.style.pointerEvents=t?"auto":"none",i.style.pointerEvents=t?"none":"auto")}),de(()=>{let t=this.messages();t.length>this.messageCount&&(this.messageCount=t.length,setTimeout(()=>this.scrollToBottom(),50))})}ngOnDestroy(){this.routeSub?.unsubscribe(),this.scrollRafId&&cancelAnimationFrame(this.scrollRafId);let t=this.messagesContainer()?.nativeElement;t&&t.removeEventListener("scroll",this.scrollHandler);for(let e of this.transientAttachmentUrls)try{URL.revokeObjectURL(e)}catch{}this.transientAttachmentUrls.clear(),this.pendingAttachmentFiles.clear()}attachScrollListener(){let t=this.messagesContainer()?.nativeElement;t&&t.addEventListener("scroll",this.scrollHandler,{passive:!0})}getDateLabel(t){let e=new Date(t),i=new Date,n=i.getTime()-e.getTime();return n<864e5&&e.getDate()===i.getDate()?"Today":n<1728e5?"Yesterday":e.toLocaleDateString("en-US",{month:"short",day:"numeric"})}onInputTextChange(t){this.inputText.set(t),this.updateHasContentState()}handleEnter(t){t.preventDefault(),this.initiateSendMessage()}goBack(){this.animationService.pageTransitionOut("#chat-room-container",()=>{this.router.navigate(["/"])})}scrollToBottom(){let t=this.messagesContainer()?.nativeElement;t&&this.animationService.smoothScrollTo(t,t.scrollHeight)}scrollToMessage(t){let e=document.getElementById("msg-"+t);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),typeof gsap<"u"&&gsap.fromTo(e,{backgroundColor:"rgba(51,144,236,0.2)"},{backgroundColor:"transparent",duration:1.5,ease:"power2.out"}))}autoGrow(t){let e=t.target;e.style.height="auto",e.style.height=Math.min(e.scrollHeight,120)+"px"}toggleAttachmentPanel(){this.showAttachmentPanel.update(t=>!t),this.showAttachmentPanel()&&(this.showEmojiPicker.set(!1),setTimeout(()=>{let t=document.getElementById("attachment-panel");t&&this.animationService.slideInFromBottom(t,200)},0))}toggleEmojiPicker(){this.showEmojiPicker.update(t=>!t),this.showEmojiPicker()&&(this.showAttachmentPanel.set(!1),setTimeout(()=>{let t=document.getElementById("emoji-picker-panel");t&&this.animationService.slideInFromBottom(t,200)},0))}onEmojiSelected(t){this.inputText.update(e=>e+t),this.updateHasContentState()}openGalleryPicker(){this.showAttachmentPanel.set(!1);let t=this.galleryInput()?.nativeElement;t&&(t.value="",t.click())}openFilePicker(){this.showAttachmentPanel.set(!1);let t=this.fileInput()?.nativeElement;t&&(t.value="",t.click())}onGalleryFilesSelected(t){let e=t.target,i=Array.from(e.files??[]);this.addFilesToPending(i),e.value=""}onFileSelected(t){let e=t.target,i=Array.from(e.files??[]);this.addFilesToPending(i),e.value=""}removePendingAttachment(t,e){if(e?.stopPropagation(),this.isUploadingAttachments())return;let i;this.pendingAttachments.update(n=>{let r=[];for(let d of n){if(d.id===t){i=d.url;continue}r.push(d)}return r}),i&&this.revokeTransientUrl(i),this.pendingAttachmentFiles.delete(t),this.updateHasContentState()}clearPendingAttachments(){if(this.isUploadingAttachments())return;let t=this.pendingAttachments().map(e=>e.url);this.pendingAttachments.set([]),this.pendingAttachmentFiles.clear();for(let e of t)this.revokeTransientUrl(e);this.updateHasContentState()}attachmentIcon(t){return t.type==="image"?"ph-fill ph-image":t.type==="video"?"ph-fill ph-video-camera":t.type==="audio"?"ph-fill ph-music-notes":"ph-fill ph-file-text"}attachmentDisplayName(t){return t.name&&t.name.trim().length>0?t.name:t.type==="image"?"Photo":t.type==="video"?"Video":t.type==="audio"?"Audio":"File"}attachmentMeta(t){let e=this.getFileExtension(t.name),i=this.formatFileSize(t.size);return e&&i?`${e.toUpperCase()} \u2022 ${i}`:e?e.toUpperCase():i||"Attachment"}getFileExtension(t){if(!t)return"";let e=t.split(".");return e.length<=1?"":e[e.length-1]}formatFileSize(t){if(!t||t<=0)return"";if(t<1024)return`${t} B`;let e=t/1024;if(e<1024)return`${e.toFixed(1)} KB`;let i=e/1024;return i<1024?`${i.toFixed(1)} MB`:`${(i/1024).toFixed(1)} GB`}openAttachment(t,e){e?.stopPropagation(),window.open(t.url,"_blank","noopener,noreferrer")}onDragOver(t){t.dataTransfer?.types&&Array.from(t.dataTransfer.types).includes("Files")&&(t.preventDefault(),t.stopPropagation(),t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),this.isDraggingFiles.set(!0))}onDragLeave(t){t.preventDefault(),t.stopPropagation();let e=t.currentTarget;if(!e){this.isDraggingFiles.set(!1);return}let i=e.getBoundingClientRect(),n=t.clientX,r=t.clientY;(n<=i.left||n>=i.right||r<=i.top||r>=i.bottom)&&this.isDraggingFiles.set(!1)}onDropFiles(t){t.preventDefault(),t.stopPropagation(),this.isDraggingFiles.set(!1);let e=Array.from(t.dataTransfer?.files??[]);this.addFilesToPending(e)}shareCurrentLocation(){if(this.showAttachmentPanel.set(!1),!navigator.geolocation){this.sendQuickMessage("\u{1F4CD} Location is not available on this device.");return}navigator.geolocation.getCurrentPosition(t=>{let e=t.coords.latitude,i=t.coords.longitude,n=`https://maps.google.com/?q=${e},${i}`,r={id:this.randomId("att"),type:"document",url:n,name:`Location (${e.toFixed(5)}, ${i.toFixed(5)})`};this.sendQuickMessage("\u{1F4CD} Shared location",[r])},()=>{this.sendQuickMessage("\u{1F4CD} Could not access your location.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4})}addFilesToPending(t){if(!t||t.length===0)return;let e=t.filter(i=>i.size>0).map(i=>this.createAttachmentFromFile(i));e.length!==0&&(this.pendingAttachments.update(i=>[...i,...e]),this.showEmojiPicker.set(!1),this.showAttachmentPanel.set(!1),this.updateHasContentState())}createAttachmentFromFile(t){let e=URL.createObjectURL(t),i=this.randomId("att");return this.transientAttachmentUrls.add(e),this.pendingAttachmentFiles.set(i,t),{id:i,type:this.resolveAttachmentType(t),url:e,name:t.name,size:t.size}}resolveAttachmentType(t){let e=(t.type||"").toLowerCase();return e.startsWith("image/")?"image":e.startsWith("video/")?"video":e.startsWith("audio/")?"audio":"document"}async uploadPendingAttachments(t){return await Promise.all(t.map(async e=>{let i=this.pendingAttachmentFiles.get(e.id);if(!i)return q({},e);let n=await he(this.api.uploadAttachment(i));return ge(q({},e),{url:n.url})}))}sendQuickMessage(t,e){let i=this.randomId("m");this.chatService.addMessage({id:i,chatId:this.chatId,senderId:this.chatService.currentUser().id,text:t,attachments:e&&e.length>0?e:void 0,timestamp:Date.now(),status:"sent"}),this.audioService.playSendSound(),setTimeout(()=>{this.scrollToBottom();let n=document.getElementById("msg-"+i);n&&this.animationService.popInMessage(n)},50)}buildAttachmentSummaryText(t,e){let i=t.trim();if(i.length>0)return i;if(e.length===1){let n=e[0];return n.type==="image"?"\u{1F5BC} Photo":n.type==="video"?"\u{1F3AC} Video":n.type==="audio"?"\u{1F3B5} Audio":`\u{1F4CE} ${n.name||"File"}`}return`\u{1F4CE} ${e.length} attachments`}randomId(t){return`${t}_${Math.random().toString(36).slice(2,10)}`}revokeTransientUrl(t){if(t.startsWith("blob:")&&this.transientAttachmentUrls.has(t)){try{URL.revokeObjectURL(t)}catch{}this.transientAttachmentUrls.delete(t)}}updateHasContentState(){let t=this.inputText().trim().length>0||this.pendingAttachments().length>0;this.hasText.set(t)}openPeerProfile(t){this.showPeerProfileCard()||this.peerProfile()&&(this.showEmojiPicker.set(!1),this.showAttachmentPanel.set(!1),this.contextMenuMsg.set(null),this.showPeerProfileCard.set(!0),this.isClosingPeerProfileCard=!1,setTimeout(()=>this.animatePeerProfileIn(t.currentTarget),0))}closePeerProfileCard(){if(!this.showPeerProfileCard()||this.isClosingPeerProfileCard)return;let t=document.getElementById("peer-profile-backdrop"),e=document.getElementById("peer-profile-card"),i=document.getElementById("peer-profile-avatar"),n=this.peerProfileTrigger()?.nativeElement;if(typeof gsap>"u"||!t||!e){this.showPeerProfileCard.set(!1),this.isClosingPeerProfileCard=!1;return}this.isClosingPeerProfileCard=!0;let r=gsap.timeline({defaults:{overwrite:"auto"},onComplete:()=>{this.showPeerProfileCard.set(!1),this.isClosingPeerProfileCard=!1}});if(i&&n){let d=i.getBoundingClientRect(),g=n.getBoundingClientRect(),f=i.cloneNode(!0);f.querySelectorAll("[id]").forEach(T=>T.removeAttribute("id")),f.style.position="fixed",f.style.left=`${d.left}px`,f.style.top=`${d.top}px`,f.style.width=`${d.width}px`,f.style.height=`${d.height}px`,f.style.pointerEvents="none",f.style.margin="0",f.style.zIndex="102",f.style.borderRadius="9999px",f.style.overflow="hidden",f.style.willChange="left, top, width, height, opacity",document.body.appendChild(f),r.to(e,{opacity:0,y:14,scale:.96,duration:.16,ease:"power2.in"},0).to(f,{left:g.left,top:g.top,width:g.width,height:g.height,opacity:0,duration:.2,ease:"power2.inOut",onComplete:()=>f.remove()},.04).to(t,{opacity:0,duration:.18,ease:"power1.out"},0);return}r.to(e,{opacity:0,y:14,scale:.96,duration:.16,ease:"power2.in"},0).to(t,{opacity:0,duration:.18,ease:"power1.out"},0)}profileInitial(t){return(t||"U").trim().charAt(0).toUpperCase()||"U"}normalizeProfileHandle(t){return t.replace(/^@+/,"").replace(/\s+/g,"_").toLowerCase()||"user"}animatePeerProfileIn(t){let e=document.getElementById("peer-profile-backdrop"),i=document.getElementById("peer-profile-card"),n=document.getElementById("peer-profile-island"),r=document.getElementById("peer-profile-avatar");if(!e||!i||!n||typeof gsap>"u")return;gsap.set(e,{opacity:0}),gsap.set(i,{opacity:0,y:24,scale:.94});let d=gsap.timeline({defaults:{overwrite:"auto"}});if(d.to(e,{opacity:1,duration:.22,ease:"power1.out"},0),t&&r){let f=t.getBoundingClientRect(),T=r.getBoundingClientRect(),x=t.cloneNode(!0);x.querySelectorAll("[id]").forEach(D=>D.removeAttribute("id")),x.style.position="fixed",x.style.left=`${f.left}px`,x.style.top=`${f.top}px`,x.style.width=`${f.width}px`,x.style.height=`${f.height}px`,x.style.pointerEvents="none",x.style.margin="0",x.style.zIndex="102",x.style.borderRadius="9999px",x.style.overflow="hidden",x.style.willChange="left, top, width, height, opacity",document.body.appendChild(x),d.to(x,{left:T.left,top:T.top,width:T.width,height:T.height,opacity:0,duration:.26,ease:"power3.out",onComplete:()=>x.remove()},.04)}d.to(i,{opacity:1,y:0,scale:1,duration:.28,ease:"back.out(1.25)"},.16);let g=n.querySelectorAll(".profile-field");g.length>0&&d.fromTo(g,{opacity:0,y:12},{opacity:1,y:0,duration:.22,stagger:.04,ease:"power2.out"},.24)}onContextMenu(t,e){t.preventDefault(),this.showEmojiPicker.set(!1),this.showAttachmentPanel.set(!1),this.isClosingContextPreview=!1,this.contextMenuMsg.set(e),setTimeout(()=>this.animateContextPreview(e.id),0)}closeContextPreview(){if(!this.contextMenuMsg())return;let t=document.getElementById("context-preview-backdrop"),e=document.getElementById("context-preview-card");if(typeof gsap>"u"||!t||!e){this.contextMenuMsg.set(null),this.isClosingContextPreview=!1;return}this.isClosingContextPreview||(this.isClosingContextPreview=!0,gsap.timeline({defaults:{overwrite:"auto"},onComplete:()=>{this.contextMenuMsg.set(null),this.isClosingContextPreview=!1}}).to(e,{y:14,scale:.96,opacity:0,duration:.16,ease:"power2.in"},0).to(t,{opacity:0,duration:.14,ease:"power1.in"},0))}onContextAction(t){let e=this.contextMenuMsg();if(e){switch(t){case"reply":this.replyingTo.set(e),setTimeout(()=>{this.messageInput()?.nativeElement.focus();let i=document.getElementById("reply-bar");i&&this.animationService.slideInFromBottom(i,50)},180);break;case"copy":e.text&&navigator.clipboard.writeText(e.text).catch(()=>{});break;case"forward":this.forwardMessage(e);break;case"delete":this.chatService.deleteMessage(e.id);break}this.closeContextPreview()}}onContextReaction(t){let e=this.contextMenuMsg();if(!e)return;this.chatService.addReaction(e.id,t);let i=document.getElementById("msg-"+e.id);if(i){let n=i.getBoundingClientRect();this.animationService.confettiExplosion(n.left+n.width/2,n.top)}this.closeContextPreview()}forwardMessage(t){if(!(!!t.text||!!t.voice))return;let i="m_"+Math.random().toString(36).substring(2,9);this.chatService.addMessage({id:i,chatId:this.chatId,senderId:this.chatService.currentUser().id,text:t.text?`Forwarded:
${t.text}`:void 0,timestamp:Date.now(),status:"sent",replyToId:t.id,voice:t.voice?q({},t.voice):void 0}),this.audioService.playSendSound(),setTimeout(()=>{this.scrollToBottom();let n=document.getElementById("msg-"+i);n&&this.animationService.popInMessage(n)},50)}animateContextPreview(t){if(typeof gsap>"u")return;let e=document.getElementById("msg-"+t),i=e?.querySelector(".group"),n=document.getElementById("context-preview-backdrop"),r=document.getElementById("context-preview-card"),d=document.getElementById("context-preview-message"),g=document.getElementById("context-preview-bubble"),f=document.getElementById("context-preview-reactions"),T=document.getElementById("context-preview-actions");if(!n||!r||!d||!g)return;if(gsap.set(n,{opacity:0}),gsap.set(r,{opacity:1,y:0,scale:1}),gsap.set(d,{opacity:0}),f&&gsap.set(f,{opacity:0,y:10}),T&&gsap.set(T,{opacity:0,y:14}),!i){let z=gsap.timeline({defaults:{overwrite:"auto"}});z.to(n,{opacity:1,duration:.2,ease:"power1.out"},0).fromTo(r,{y:26,scale:.94,opacity:0},{y:0,scale:1,opacity:1,duration:.28,ease:"back.out(1.25)"},0).to(d,{opacity:1,duration:.08,ease:"none"},.2),f&&z.to(f,{opacity:1,y:0,duration:.2,ease:"power2.out"},.26),T&&z.to(T,{opacity:1,y:0,duration:.22,ease:"power2.out"},.3);return}let x=i.getBoundingClientRect(),D=g.getBoundingClientRect(),I=i.cloneNode(!0);I.querySelectorAll("[id]").forEach(z=>z.removeAttribute("id")),I.style.position="fixed",I.style.left=`${x.left}px`,I.style.top=`${x.top}px`,I.style.width=`${x.width}px`,I.style.height=`${x.height}px`,I.style.margin="0",I.style.pointerEvents="none",I.style.zIndex="102",I.style.overflow="hidden",I.style.willChange="left, top, width, height, opacity",document.body.appendChild(I),e&&gsap.fromTo(e,{scale:1},{scale:.985,duration:.14,ease:"power1.inOut",yoyo:!0,repeat:1});let N=gsap.timeline({defaults:{overwrite:"auto"},onComplete:()=>I.remove()});N.to(n,{opacity:1,duration:.2,ease:"power1.out"},0).to(I,{left:D.left,top:D.top,width:D.width,height:D.height,borderRadius:getComputedStyle(g).borderRadius,duration:.34,ease:"power3.out"},.02).to(I,{opacity:0,duration:.12,ease:"power2.in"},.26).to(d,{opacity:1,duration:.08,ease:"none"},.28),f&&N.to(f,{opacity:1,y:0,duration:.2,ease:"power2.out"},.34),T&&N.to(T,{opacity:1,y:0,duration:.22,ease:"power2.out"},.38)}toggleReaction(t,e,i){this.chatService.addReaction(t,e),this.animationService.elasticButton(i.currentTarget)}cancelReply(){this.replyingTo.set(null)}async initiateSendMessage(){let t=this.inputText().trim(),e=this.pendingAttachments().map(x=>q({},x));if(t.length===0&&e.length===0||this.isUploadingAttachments())return;let i=this.messageInput()?.nativeElement;if(!i)return;let n=e;if(e.length>0){this.isUploadingAttachments.set(!0);try{n=await this.uploadPendingAttachments(e)}catch(x){console.error("Failed to upload attachment(s):",x),this.isUploadingAttachments.set(!1);return}this.isUploadingAttachments.set(!1)}let r=this.buildAttachmentSummaryText(t,n),d=e.map(x=>x.url);this.inputText.set(""),this.pendingAttachments.set([]),this.pendingAttachmentFiles.clear();for(let x of d)this.revokeTransientUrl(x);this.updateHasContentState(),i.style.height="auto",i.focus();let g=this.randomId("m"),f=this.replyingTo(),T={id:g,chatId:this.chatId,senderId:this.chatService.currentUser().id,text:r,attachments:n.length>0?n.map(x=>q({},x)):void 0,timestamp:Date.now(),status:"sending",isAnimating:!0,replyToId:f?.id};this.replyingTo.set(null),this.showEmojiPicker.set(!1),this.chatService.addMessage(T),this.audioService.playSendSound(),setTimeout(async()=>{this.scrollToBottom();let x=document.getElementById("msg-"+g);t.length>0&&x&&i&&await this.animationService.animateSendText({sourceTextEl:i,targetPlaceholderEl:x,text:t,isMine:!0}),this.chatService.updateMessage(g,{isAnimating:!1,status:"sent"}),setTimeout(()=>this.chatService.updateMessage(g,{status:"delivered"}),1e3),setTimeout(()=>this.chatService.updateMessage(g,{status:"seen"}),3e3)},10)}async startRecording(){await this.voiceRecorder.startRecording()}async stopAndSendRecording(){let t=await this.voiceRecorder.stopRecording();if(t&&t.durationMs>0){let e="m_"+Math.random().toString(36).substring(2,9);this.chatService.addMessage({id:e,chatId:this.chatId,senderId:this.chatService.currentUser().id,timestamp:Date.now(),status:"sent",voice:{storageKey:t.storageKey,url:t.blobUrl,duration:Math.round(t.durationMs/1e3),durationMs:t.durationMs,waveform:t.waveform}}),this.audioService.playSendSound(),setTimeout(()=>{this.scrollToBottom();let i=document.getElementById("msg-"+e);i&&this.animationService.popInMessage(i)},50)}}cancelRecording(){this.voiceRecorder.cancelRecording()}formatDuration(t){let e=Math.floor(t/60),i=Math.floor(t%60);return`${e}:${i<10?"0":""}${i}`}onTouchStart(t,e){this.swipingMsgId.set(e.id),this.swipeStartX=t.touches[0].clientX,this.swipeStartY=t.touches[0].clientY,this.swipeX.set(0),this.swipeDirectionLocked=null}onTouchMove(t,e){if(this.swipingMsgId()!==e.id)return;let i=t.touches[0].clientX-this.swipeStartX,n=t.touches[0].clientY-this.swipeStartY;if(!this.swipeDirectionLocked){(Math.abs(i)>8||Math.abs(n)>8)&&(this.swipeDirectionLocked=Math.abs(i)>Math.abs(n)?"h":"v");return}if(this.swipeDirectionLocked==="v")return;let r=e.senderId===this.chatService.currentUser().id;r&&i<0?this.swipeX.set(Math.max(i,-60)):!r&&i>0&&this.swipeX.set(Math.min(i,60))}onTouchEnd(t,e){this.swipingMsgId()===e.id&&(Math.abs(this.swipeX())>40&&(this.replyingTo.set(e),this.messageInput()?.nativeElement.focus(),navigator.vibrate&&navigator.vibrate(50),setTimeout(()=>{let i=document.getElementById("reply-bar");i&&this.animationService.slideInFromBottom(i,50)},10)),this.swipeX.set(0),this.swipeDirectionLocked=null,setTimeout(()=>this.swipingMsgId.set(null),300))}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=$({type:o,selectors:[["app-chat-room"]],viewQuery:function(e,i){e&1&&ee(i.messagesContainer,nt,5)(i.messageInput,ot,5)(i.sendBtn,rt,5)(i.micBtn,at,5)(i.peerProfileTrigger,lt,5)(i.galleryInput,st,5)(i.fileInput,ct,5),e&2&&te(7)},decls:45,vars:22,consts:[["peerProfileTrigger",""],["messagesContainer",""],["galleryInput",""],["fileInput",""],["statusText",""],["messageInput",""],["sendBtn",""],["micBtn",""],["id","chat-room-container",1,"flex","flex-col","h-screen","w-full","overflow-hidden","relative",3,"dragover","dragleave","drop"],[1,"fixed","inset-0","pointer-events-none","z-0",2,"background","linear-gradient(180deg, var(--tg-gradient-start) 0%, transparent 30%, transparent 70%, var(--tg-gradient-end) 100%)","opacity","0.15"],[1,"absolute","inset-0","z-40","flex","items-center","justify-center","p-4","bg-black/40",2,"backdrop-filter","blur(6px)","-webkit-backdrop-filter","blur(6px)"],[1,"safe-pt","px-2","pb-2","flex","items-center","z-20","sticky","top-0","glass-strong","border-b","border-white/10","relative"],[1,"p-2","mr-1","rounded-full","text-telegram-primary","hover:bg-white/10","transition-all","active:scale-90","z-10",3,"click"],[1,"ph","ph-caret-left","text-2xl"],[1,"flex","flex-1","items-center","gap-3","cursor-pointer","z-10",3,"click"],[1,"w-9","h-9","rounded-full","bg-telegram-primary","text-white","flex","items-center","justify-center","shrink-0"],["size","sm",3,"src","name","isOnline"],[1,"flex","flex-col"],[1,"font-semibold","text-base","leading-tight"],[1,"text-xs","text-telegram-primary"],[1,"flex","items-center","gap-1","text-telegram-primary","z-10"],[1,"p-2","rounded-full","hover:bg-white/10","active:scale-90","transition-all",3,"click"],[1,"flex-1","overflow-y-auto","px-4","pt-4","flex","flex-col","gap-1","relative","telegram-pattern","custom-scrollbar"],["id","scroll-bottom-btn",1,"absolute","bottom-[80px]","right-4","z-30","w-10","h-10","rounded-full","bg-white","dark:bg-telegram-surface","shadow-lg","flex","items-center","justify-center","text-telegram-primary","hover:scale-110","active:scale-90","transition-all","border","border-gray-200","dark:border-gray-700"],["id","context-preview-backdrop",1,"fixed","inset-0","z-[100]","flex","items-center","justify-center","p-4",2,"background","rgba(10, 14, 20, 0.38)","backdrop-filter","blur(12px)","-webkit-backdrop-filter","blur(12px)"],["id","peer-profile-backdrop",1,"fixed","inset-0","z-[100]","flex","items-center","justify-center","p-4",2,"background","rgba(10, 14, 20, 0.42)","backdrop-filter","blur(12px)","-webkit-backdrop-filter","blur(12px)"],["id","reply-bar",1,"absolute","bottom-[80px]","left-3","right-3","px-3","py-2","flex","items-center","gap-2","z-30","bg-white","dark:bg-telegram-surface","rounded-2xl","shadow-md","shadow-black/5","dark:shadow-black/20"],["id","attachment-panel",1,"absolute","bottom-[80px]","left-3","right-3","p-4","z-30","bg-white","dark:bg-telegram-surface","shadow-xl","rounded-2xl"],["type","file","accept","image/*,video/*","multiple","",1,"hidden",3,"change"],["type","file","multiple","",1,"hidden",3,"change"],[1,"absolute","z-30","bg-white","dark:bg-telegram-surface","rounded-2xl","shadow-md","px-3","py-2","w-[230px]","max-w-[calc(100%-1.5rem)]",2,"left","0.75rem",3,"bottom"],[1,"safe-pb","absolute","bottom-0","left-0","right-0","z-20","px-4","pb-2","pt-2"],[1,"flex","items-end","px-3","py-2","gap-1.5","min-h-[52px]","bg-white/90","dark:bg-telegram-surface","rounded-3xl","shadow-xl","border","border-gray-200","dark:border-gray-700/50",2,"backdrop-filter","blur(16px)","-webkit-backdrop-filter","blur(16px)"],[1,"p-1.5","transition-all","mb-0.5","shrink-0","active:scale-90",3,"click"],[1,"ph","ph-smiley","text-2xl"],[1,"flex-1","flex","items-center","relative","min-h-[36px]","max-h-[120px]"],[1,"flex-1","flex","items-center","justify-between","px-2","h-9"],["placeholder","Message","rows","1",1,"w-full","bg-transparent","text-black","dark:text-white","py-2","outline-none","resize-none","no-scrollbar","max-h-[120px]","placeholder-gray-400","dark:placeholder-gray-500","text-[15px]","leading-snug",2,"border","none","box-shadow","none",3,"ngModel"],[1,"p-1.5","text-gray-400","hover:text-telegram-primary","transition-all","mb-0.5","shrink-0","active:scale-90",3,"click"],[1,"ph","ph-paperclip","text-xl","transform","-rotate-45"],[1,"relative","h-9","shrink-0","mb-0.5","flex","items-center","justify-end","overflow-visible"],[1,"absolute","right-0","w-full","flex","items-center","justify-end","gap-2"],[1,"bg-white","dark:bg-telegram-surface","rounded-2xl","border","border-gray-200","dark:border-gray-700","px-5","py-4","text-center","shadow-xl"],[1,"ph-fill","ph-upload-simple","text-2xl","text-telegram-primary","block","mb-2"],[1,"text-sm","font-semibold"],[1,"text-xs","text-telegram-muted","mt-1"],[1,"ph-fill","ph-bookmark-simple","text-lg"],[3,"label"],[1,"message-bubble","flex","flex-col","relative","z-10",3,"self-end","self-start","max-w-[80%]","mt-0","mt-2","transform","id","opacity"],[1,"message-bubble","flex","flex-col","relative","z-10",3,"touchstart","touchmove","touchend","contextmenu","id"],[1,"px-3","py-1.5","shadow-sm","text-[15px]","relative","group","transition-all"],[1,"text-xs","font-semibold","text-telegram-primary","mb-0.5"],[3,"audioUrl","durationMs","waveform","isMine"],[1,"flex","flex-col","gap-2","mb-1"],[1,"leading-relaxed","whitespace-pre-wrap","break-words",3,"id"],[1,"flex","items-center","gap-1","text-[10px]","mt-0.5","justify-end","ml-3"],[1,"tabular-nums"],[1,"flex","flex-wrap","gap-1","mt-1",3,"self-end","self-start"],[1,"flex","items-center","gap-2","px-3","py-1.5","mb-0.5","rounded-xl","text-xs","cursor-pointer","opacity-80","hover:opacity-100","transition-opacity",3,"class"],[1,"flex","items-center","gap-2","px-3","py-1.5","mb-0.5","rounded-xl","text-xs","cursor-pointer","opacity-80","hover:opacity-100","transition-opacity",3,"click"],[1,"w-0.5","h-6","rounded-full"],[1,"min-w-0"],[1,"font-semibold","truncate"],[1,"truncate","text-gray-400"],[1,"rounded-xl","overflow-hidden","border",3,"class"],[1,"rounded-xl","border","px-2","py-2",3,"class"],[1,"w-full","flex","items-center","gap-2","px-2","py-2","rounded-xl","border","text-left","transition-all","active:scale-95",3,"class"],[1,"rounded-xl","overflow-hidden","border"],[1,"w-full","cursor-pointer",2,"max-height","260px","object-fit","cover",3,"click","src","alt"],["controls","","playsinline","","preload","metadata",1,"w-full",2,"max-height","240px","background","rgba(0,0,0,0.2)"],[3,"src"],[1,"w-full","flex","items-center","gap-2","px-2","py-2","text-left",3,"click"],[1,"w-8","h-8","rounded-lg","flex","items-center","justify-center","bg-telegram-primary/10","text-telegram-primary","shrink-0"],[1,"ph-fill","ph-video-camera","text-base"],[1,"flex-1","min-w-0"],[1,"text-sm","truncate"],[1,"text-xs"],[1,"ph","ph-arrow-up-right","text-sm"],[1,"rounded-xl","border","px-2","py-2"],[1,"flex","items-center","gap-2","mb-1"],[1,"ph-fill","ph-music-notes","text-base"],["controls","",1,"w-full",3,"src"],[1,"w-full","flex","items-center","gap-2","px-2","py-2","rounded-xl","border","text-left","transition-all","active:scale-95",3,"click"],[1,"ph","ph-download-simple","text-lg"],[1,"ph","ph-clock","text-xs","opacity-60"],[1,"ph","ph-check","text-xs"],[1,"ph-bold","ph-checks","text-xs"],[1,"ph-bold","ph-checks","text-xs","text-green-400"],[1,"flex","flex-wrap","gap-1","mt-1"],[1,"flex","items-center","gap-0.5","px-1.5","py-0.5","rounded-full","text-xs","border","transition-all","hover:scale-105","active:scale-95",3,"class"],[1,"flex","items-center","gap-0.5","px-1.5","py-0.5","rounded-full","text-xs","border","transition-all","hover:scale-105","active:scale-95",3,"click"],[1,"font-medium"],["id","scroll-bottom-btn",1,"absolute","bottom-[80px]","right-4","z-30","w-10","h-10","rounded-full","bg-white","dark:bg-telegram-surface","shadow-lg","flex","items-center","justify-center","text-telegram-primary","hover:scale-110","active:scale-90","transition-all","border","border-gray-200","dark:border-gray-700",3,"click"],[1,"ph-bold","ph-caret-down","text-lg"],["id","context-preview-backdrop",1,"fixed","inset-0","z-[100]","flex","items-center","justify-center","p-4",2,"background","rgba(10, 14, 20, 0.38)","backdrop-filter","blur(12px)","-webkit-backdrop-filter","blur(12px)",3,"click"],["id","context-preview-card",1,"w-full","max-w-[340px]","flex","flex-col","gap-2",3,"click"],["id","context-preview-message",1,"w-full"],["id","context-preview-bubble",1,"px-3","py-2","shadow-xl","text-[15px]","transition-all"],[1,"leading-relaxed","whitespace-pre-wrap","break-words"],["id","context-preview-reactions",1,"flex","items-center","justify-center","gap-1","bg-white","dark:bg-telegram-surface","rounded-full","p-1.5","shadow-xl"],[1,"w-9","h-9","flex","items-center","justify-center","text-xl","rounded-full","hover:bg-gray-100","dark:hover:bg-gray-700","transition-all","hover:scale-125","active:scale-90"],["id","context-preview-actions",1,"bg-white","dark:bg-telegram-surface","rounded-2xl","shadow-xl","border","border-gray-100","dark:border-gray-700/50","p-1"],[1,"flex","items-center","gap-1"],[1,"flex-1","flex","flex-col","items-center","justify-center","gap-0.5","py-2","rounded-xl","text-xs","text-black","dark:text-white","hover:bg-gray-50","dark:hover:bg-gray-700/50","transition-colors",3,"click"],[1,"ph","ph-arrow-bend-up-left","text-lg"],[1,"ph","ph-share","text-lg"],[1,"ph","ph-copy","text-lg"],[1,"flex-1","flex","flex-col","items-center","justify-center","gap-0.5","py-2","rounded-xl","text-xs","text-red-500","hover:bg-red-50","dark:hover:bg-red-900/20","transition-colors",3,"click"],[1,"ph","ph-trash","text-lg"],[1,"flex","items-center","gap-0.5","px-1.5","py-0.5","rounded-full","text-xs","border",3,"class"],[1,"flex","items-center","gap-0.5","px-1.5","py-0.5","rounded-full","text-xs","border"],[1,"w-9","h-9","flex","items-center","justify-center","text-xl","rounded-full","hover:bg-gray-100","dark:hover:bg-gray-700","transition-all","hover:scale-125","active:scale-90",3,"click"],["id","peer-profile-backdrop",1,"fixed","inset-0","z-[100]","flex","items-center","justify-center","p-4",2,"background","rgba(10, 14, 20, 0.42)","backdrop-filter","blur(12px)","-webkit-backdrop-filter","blur(12px)",3,"click"],["id","peer-profile-card",1,"w-full",2,"max-width","360px",3,"click"],["id","peer-profile-island",1,"flex","flex-col","gap-3"],[1,"profile-field","flex","items-center","justify-between","bg-white/90","dark:bg-telegram-surface","rounded-2xl","border","border-gray-200","dark:border-gray-700/50","shadow-md","px-3","py-2",2,"backdrop-filter","blur(16px)","-webkit-backdrop-filter","blur(16px)"],[1,"text-sm","font-semibold","text-telegram-primary"],[1,"w-8","h-8","rounded-full","hover:bg-gray-100","dark:hover:bg-gray-700/50","transition-colors","active:scale-90",3,"click"],[1,"ph","ph-x","text-lg"],[1,"profile-field","flex","flex-col","items-center","gap-2","bg-white/90","dark:bg-telegram-surface","rounded-3xl","border","border-gray-200","dark:border-gray-700/50","shadow-md","px-4","py-3",2,"backdrop-filter","blur(16px)","-webkit-backdrop-filter","blur(16px)"],["id","peer-profile-avatar",1,"w-16","h-16","rounded-full","overflow-hidden","border","border-gray-200","dark:border-gray-700","shadow-md"],["alt","Profile avatar",1,"w-full","h-full",2,"object-fit","cover",3,"src"],[1,"w-full","h-full","bg-telegram-primary","text-white","flex","items-center","justify-center","font-bold","text-xl"],[1,"min-w-0","text-center"],[1,"text-xs","text-telegram-muted","truncate"],[1,"profile-field","flex","flex-col","gap-1","bg-white/90","dark:bg-telegram-surface","rounded-2xl","border","border-gray-200","dark:border-gray-700/50","shadow-md","px-3","py-2",2,"backdrop-filter","blur(16px)","-webkit-backdrop-filter","blur(16px)"],[1,"text-xs","text-telegram-muted"],[1,"text-sm","font-medium"],[1,"text-sm"],[1,"text-sm","leading-relaxed","whitespace-pre-wrap","break-words"],["id","emoji-picker-panel",1,"absolute","bottom-[80px]","left-3","right-3","z-30","flex","justify-center"],[3,"emojiSelected"],[1,"fixed","inset-0","z-20",3,"click"],[1,"w-0.5","h-8","bg-telegram-primary","rounded-full","shrink-0"],[1,"text-xs","font-semibold","text-telegram-primary"],[1,"text-xs","text-gray-500","truncate"],[1,"p-1","text-gray-400","hover:text-gray-600","transition-colors","active:scale-90",3,"click"],[1,"w-10","h-1","bg-gray-300","dark:bg-gray-600","rounded-full","mx-auto","mb-4"],[1,"grid","grid-cols-4","gap-4"],[1,"flex","flex-col","items-center","gap-2","group",3,"click"],[1,"w-14","h-14","rounded-2xl","bg-blue-500/10","text-blue-500","flex","items-center","justify-center","text-2xl","group-active:scale-90","transition-transform"],[1,"ph-fill","ph-image"],[1,"text-xs","font-medium"],[1,"w-14","h-14","rounded-2xl","bg-orange-500/10","text-orange-500","flex","items-center","justify-center","text-2xl","group-active:scale-90","transition-transform"],[1,"ph-fill","ph-file-text"],[1,"w-14","h-14","rounded-2xl","bg-purple-500/10","text-purple-500","flex","items-center","justify-center","text-2xl","group-active:scale-90","transition-transform"],[1,"ph-fill","ph-map-pin"],[1,"w-14","h-14","rounded-2xl","bg-gray-500/10","text-gray-500","flex","items-center","justify-center","text-2xl","group-active:scale-90","transition-transform"],[1,"ph","ph-x"],[1,"absolute","z-30","bg-white","dark:bg-telegram-surface","rounded-2xl","shadow-md","px-3","py-2","w-[230px]","max-w-[calc(100%-1.5rem)]",2,"left","0.75rem"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-xs","text-red-500","disabled:opacity-50",3,"click","disabled"],[1,"flex","gap-2","overflow-y-hidden","overflow-x-auto","no-scrollbar"],[1,"relative","w-14","h-14","rounded-xl","overflow-hidden","border","border-gray-200","dark:border-gray-700","shrink-0"],[1,"w-full","h-full",2,"object-fit","cover",3,"src","alt"],[1,"w-full","h-full","flex","items-center","justify-center","bg-gray-100","dark:bg-gray-800","text-telegram-primary"],[1,"absolute","top-0","right-0","w-5","h-5","rounded-full","bg-black/40","text-white","text-xs","flex","items-center","justify-center",3,"click","disabled"],[1,"flex","items-center","gap-2"],[1,"w-2.5","h-2.5","rounded-full","bg-red-500","animate-pulse"],[1,"font-mono","text-red-400","font-medium","tabular-nums","text-sm"],["placeholder","Message","rows","1",1,"w-full","bg-transparent","text-black","dark:text-white","py-2","outline-none","resize-none","no-scrollbar","max-h-[120px]","placeholder-gray-400","dark:placeholder-gray-500","text-[15px]","leading-snug",2,"border","none","box-shadow","none",3,"ngModelChange","input","keydown.enter","ngModel"],[1,"w-9","h-9","rounded-full","bg-gray-200","dark:bg-gray-800","text-gray-600","dark:text-gray-300","flex","items-center","justify-center","shrink-0","active:scale-90","transition-transform",3,"click"],[1,"ph-fill","ph-trash","text-lg"],[1,"w-9","h-9","rounded-full","bg-telegram-primary","text-white","flex","items-center","justify-center","shrink-0","active:scale-90","transition-transform",3,"click"],[1,"ph-fill","ph-paper-plane-right","text-lg"],[1,"absolute","inset-0","w-9","h-9","rounded-full","bg-telegram-primary","text-white","flex","items-center","justify-center","opacity-0","scale-50","pointer-events-none","origin-center","shadow-md","disabled:opacity-70",3,"click","disabled"],[1,"absolute","inset-0","w-9","h-9","rounded-full","text-telegram-primary","hover:bg-white/10","flex","items-center","justify-center","origin-center","active:scale-90","transition-all",3,"click"],[1,"ph-fill","ph-microphone","text-2xl"]],template:function(e,i){if(e&1){let n=k();l(0,"div",8),_("dragover",function(d){return p(n),u(i.onDragOver(d))})("dragleave",function(d){return p(n),u(i.onDragLeave(d))})("drop",function(d){return p(n),u(i.onDropFiles(d))}),h(1,"div",9),v(2,mt,7,0,"div",10),l(3,"header",11)(4,"button",12),_("click",function(){return p(n),u(i.goBack())}),h(5,"i",13),c(),l(6,"div",14,0),_("click",function(d){let g;return p(n),u(((g=i.chat())==null?null:g.type)!=="saved"?i.openPeerProfile(d):null)}),v(8,pt,2,0,"div",15)(9,ut,1,3,"app-avatar",16),l(10,"div",17)(11,"h2",18),m(12),c(),v(13,gt,3,1,"span",19),c()(),l(14,"div",20)(15,"button",21),_("click",function(d){return p(n),u(i.themeService.toggleTheme(d))}),h(16,"i"),c()()(),l(17,"div",22,1),V(19,jt,2,1,null,null,dt),v(21,Ft,1,0,"app-typing-indicator"),c(),v(22,Bt,2,0,"button",23),v(23,Ot,35,13,"div",24),v(24,qt,33,7,"div",25),v(25,Qt,3,0),v(26,Yt,9,2,"div",26),v(27,Kt,23,0,"div",27),l(28,"input",28,2),_("change",function(d){return p(n),u(i.onGalleryFilesSelected(d))}),c(),l(30,"input",29,3),_("change",function(d){return p(n),u(i.onFileSelected(d))}),c(),v(32,ii,10,4,"div",30),l(33,"footer",31)(34,"div",32)(35,"button",33),_("click",function(){return p(n),u(i.toggleEmojiPicker())}),h(36,"i",34),c(),l(37,"div",35),v(38,ni,7,1,"div",36)(39,oi,2,1,"textarea",37),c(),l(40,"button",38),_("click",function(){return p(n),u(i.toggleAttachmentPanel())}),h(41,"i",39),c(),l(42,"div",40),v(43,ri,5,0,"div",41)(44,ai,6,1),c()()()()}if(e&2){let n,r,d,g;a(2),C(i.isDraggingFiles()?2:-1),a(6),C(((n=i.chat())==null?null:n.type)==="saved"?8:9),a(4),R(" ",((r=i.chat())==null?null:r.type)==="saved"?"Saved Messages":((r=i.chat())==null?null:r.type)==="direct"?(r=i.participant())==null?null:r.name:(r=i.chat())==null?null:r.name," "),a(),C(((d=i.chat())==null?null:d.type)!=="saved"?13:-1),a(3),w("ph "+i.themeService.getThemeInfo(i.themeService.currentTheme()).icon+" text-xl"),a(),Y("padding-bottom",i.replyingTo()?"9.25rem":"6rem"),a(2),A(i.displayItems()),a(2),C(i.isTyping()&&((g=i.chat())==null?null:g.type)!=="saved"?21:-1),a(),C(i.showScrollBtn()?22:-1),a(),C(i.contextMenuMsg()?23:-1),a(),C(i.showPeerProfileCard()&&i.peerProfile()?24:-1),a(),C(i.showEmojiPicker()?25:-1),a(),C(i.replyingTo()?26:-1),a(),C(i.showAttachmentPanel()?27:-1),a(5),C(i.pendingAttachments().length>0?32:-1),a(3),w(i.showEmojiPicker()?"text-telegram-primary":"text-gray-400 hover:text-telegram-primary"),a(3),C(i.voiceRecorder.isRecording()?38:39),a(4),Y("width",i.voiceRecorder.isRecording()?"5rem":"2.25rem"),a(),C(i.voiceRecorder.isRecording()?43:44)}},dependencies:[Ie,ne,re,ae,le,De,Pe,Ve,Ae,Re],encapsulation:2})}};export{Fe as ChatRoomComponent};
