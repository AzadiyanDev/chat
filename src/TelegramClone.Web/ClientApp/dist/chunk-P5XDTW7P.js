import{a as ye,b as be,d as we,e as ke,f as Ee,g as Se,h as Te}from"./chunk-IEYFNZVO.js";import{a as Me,b as Ie,e as Re,h as Pe}from"./chunk-MMPFBZYR.js";import{$ as Z,A as N,Aa as ve,Ca as Ce,G as q,H as _,I as v,J as O,K as fe,L as P,M as V,N as $,O as l,P as c,Q as f,R as C,S as b,T as j,U as E,V as ce,W as x,X as B,Y as s,Z as K,_ as W,aa as Q,ba as M,ca as u,da as T,ea as R,g as ue,ia as Y,j as A,ja as X,k as m,ka as w,l as p,la as xe,m as H,n as le,na as de,oa as me,p as k,q as se,qa as D,ra as _e,sa as G,ta as F,v as ge,w as a,x as he}from"./chunk-X5AKF7Z7.js";import{a as pe}from"./chunk-3RHWOS5U.js";var ee=class o{constructor(){this.storageService=A(we);this.mediaRecorder=null;this.audioChunks=[];this.isRecording=k(!1);this.recordingDuration=k(0);this.audioCtx=null}getAudioCtx(){return this.audioCtx||(this.audioCtx=new AudioContext),this.audioCtx}async startRecording(){try{let t=await navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(t),this.audioChunks=[],this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.audioChunks.push(e.data)},this.mediaRecorder.start(),this.isRecording.set(!0),this.recordingDuration.set(0),this.timerInterval=setInterval(()=>{this.recordingDuration.update(e=>e+1)},1e3)}catch(t){console.error("Microphone access error:",t),alert("Microphone access is required to record voice messages.")}}stopRecording(){return new Promise(t=>{if(!this.mediaRecorder||this.mediaRecorder.state==="inactive")return t(null);this.mediaRecorder.onstop=async()=>{clearInterval(this.timerInterval);let e=new Blob(this.audioChunks,{type:"audio/webm"}),i=this.recordingDuration()*1e3,n=[];try{let h=await e.arrayBuffer(),g=await this.getAudioCtx().decodeAudioData(h.slice(0));i=g.duration*1e3;let S=g.getChannelData(0),y=50,L=Math.floor(S.length/y);for(let U=0;U<y;U++){let z=0;for(let ae=0;ae<L;ae++)z+=Math.abs(S[U*L+ae]);n.push(z/L)}let I=Math.max(...n,.01);n=n.map(U=>Math.max(.1,U/I))}catch(h){console.error("Audio decode error, using fallback",h),n=Array.from({length:50},()=>Math.random()*.8+.2)}let r="voice_"+Date.now()+"_"+Math.random().toString(36).substr(2,5);await this.storageService.saveVoice(r,e);let d=URL.createObjectURL(e);this.isRecording.set(!1),this.recordingDuration.set(0),this.mediaRecorder?.stream.getTracks().forEach(h=>h.stop()),this.mediaRecorder=null,t({blob:e,blobUrl:d,durationMs:i,waveform:n,storageKey:r})},this.mediaRecorder.stop()})}cancelRecording(){this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(this.mediaRecorder.stop(),clearInterval(this.timerInterval),this.isRecording.set(!1),this.recordingDuration.set(0),this.mediaRecorder.stream.getTracks().forEach(t=>t.stop()),this.mediaRecorder=null)}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=ue({token:o,factory:o.\u0275fac,providedIn:"root"})}};var De=["audioElement"],Le=["playBtn"],Ae=["speedBtn"];function Ne(o,t){o&1&&(H(),j(0,"rect",17)(1,"rect",18))}function Fe(o,t){o&1&&(H(),j(0,"path",7))}function Ue(o,t){if(o&1&&(H(),j(0,"rect")),o&2){let e=t.$implicit,i=t.$index,n=s();q("x",i*(100/n.waveform().length)+"%")("y",(100-e*100)/2+"%")("width",100/n.waveform().length*.6+"%")("height",n.Math.max(e*100,6)+"%")("rx",1.5)("fill",n.unplayedColor())}}function $e(o,t){if(o&1&&(H(),j(0,"rect")),o&2){let e=t.$implicit,i=t.$index,n=s();q("x",i*(100/n.waveform().length)+"%")("y",(100-e*100)/2+"%")("width",100/n.waveform().length*.6+"%")("height",n.Math.max(e*100,6)+"%")("rx",1.5)("fill",n.playedColor())}}var te=class o{constructor(){this.audioUrl=G.required();this.durationMs=G.required();this.waveform=G([]);this.isMine=G(!1);this.audioRef=F("audioElement");this.playBtn=F("playBtn");this.speedBtn=F("speedBtn");this.isPlaying=k(!1);this.currentTime=k(0);this.progressPercentage=k(0);this.playbackSpeed=k(1);this.instanceId=Math.random().toString(36).substring(2,8);this.Math=Math;this.speeds=[1,1.5,2,.5]}playedColor(){return this.isMine()?"#ffffff":"#3390ec"}unplayedColor(){return this.isMine()?"rgba(255,255,255,0.3)":"rgba(150,150,150,0.3)"}togglePlay(t){t.stopPropagation();let e=this.audioRef()?.nativeElement;if(!e)return;this.isPlaying()?(e.pause(),this.isPlaying.set(!1)):(e.playbackRate=this.playbackSpeed(),e.play().catch(n=>console.error("Audio play failed",n)),this.isPlaying.set(!0));let i=this.playBtn()?.nativeElement;i&&typeof gsap<"u"&&gsap.fromTo(i,{scale:.8},{scale:1,duration:.4,ease:"elastic.out(1.2, 0.4)"})}cycleSpeed(t){t.stopPropagation();let i=(this.speeds.indexOf(this.playbackSpeed())+1)%this.speeds.length;this.playbackSpeed.set(this.speeds[i]);let n=this.audioRef()?.nativeElement;n&&(n.playbackRate=this.playbackSpeed());let r=this.speedBtn()?.nativeElement;r&&typeof gsap<"u"&&gsap.fromTo(r,{scale:.7,rotation:-10},{scale:1,rotation:0,duration:.4,ease:"elastic.out(1, 0.3)"})}scrub(t){t.stopPropagation();let i=t.currentTarget.getBoundingClientRect(),n=Math.max(0,Math.min(1,(t.clientX-i.left)/i.width)),r=this.audioRef()?.nativeElement,d=this.durationMs()/1e3;r&&d>0&&(r.currentTime=n*d,this.currentTime.set(r.currentTime),this.progressPercentage.set(n*100))}onTimeUpdate(t){let e=t.target;this.currentTime.set(e.currentTime);let i=this.durationMs()/1e3;i>0&&this.progressPercentage.set(e.currentTime/i*100)}onEnded(){this.isPlaying.set(!1),this.currentTime.set(0),this.progressPercentage.set(0);let t=this.audioRef()?.nativeElement;t&&(t.currentTime=0)}formatTime(t){if(isNaN(t)||!isFinite(t))return"0:00";let e=Math.floor(t/60),i=Math.floor(t%60);return`${e}:${i<10?"0":""}${i}`}ngOnDestroy(){let t=this.audioRef()?.nativeElement;t&&(t.pause(),t.removeAttribute("src"),t.load())}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=N({type:o,selectors:[["app-voice-player"]],viewQuery:function(e,i){e&1&&K(i.audioRef,De,5)(i.playBtn,Le,5)(i.speedBtn,Ae,5),e&2&&W(3)},inputs:{audioUrl:[1,"audioUrl"],durationMs:[1,"durationMs"],waveform:[1,"waveform"],isMine:[1,"isMine"]},decls:25,vars:20,consts:[["playBtn",""],["svgScrubber",""],["speedBtn",""],["audioElement",""],[1,"flex","items-center","gap-3","h-12","min-w-[220px]","max-w-full"],[1,"w-11","h-11","rounded-full","flex","items-center","justify-center","shrink-0","shadow-sm","transition-all","active:scale-90","hover:shadow-md",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M6 4.832c0-1.429 1.554-2.318 2.794-1.598l12.255 7.168c1.218.712 1.218 2.484 0 3.196L8.794 20.766C7.554 21.486 6 20.597 6 19.168V4.832z"],[1,"flex","flex-col","flex-1","justify-center","relative","h-full"],["preserveAspectRatio","none",1,"w-full","h-8","cursor-pointer",3,"click"],[3,"id"],["x","0","y","0","height","100%"],["cy","50%","r","4",1,"transition-all"],[1,"flex","justify-between","items-center","text-[10px]","font-medium","leading-none"],[1,"tabular-nums"],[1,"px-1.5","py-0.5","rounded-full","text-[9px]","font-bold","transition-all","hover:scale-105","active:scale-95",3,"click"],[1,"hidden",3,"ended","timeupdate","src"],["x","5","y","4","width","5","height","16","rx","1.5"],["x","14","y","4","width","5","height","16","rx","1.5"]],template:function(e,i){if(e&1){let n=E();C(0,"div",4)(1,"button",5,0),B("click",function(d){return m(n),p(i.togglePlay(d))}),H(),C(3,"svg",6),_(4,Ne,2,0)(5,Fe,1,0,":svg:path",7),b()(),le(),C(6,"div",8),H(),C(7,"svg",9,1),B("click",function(d){return m(n),p(i.scrub(d))}),P(9,Ue,1,6,":svg:rect",null,O),C(11,"clipPath",10),j(12,"rect",11),b(),C(13,"g"),P(14,$e,1,6,":svg:rect",null,O),b(),j(16,"circle",12),b(),le(),C(17,"div",13)(18,"span",14),u(19),b(),C(20,"button",15,2),B("click",function(d){return m(n),p(i.cycleSpeed(d))}),u(22),b()()(),C(23,"audio",16,3),B("ended",function(){return m(n),p(i.onEnded())})("timeupdate",function(d){return m(n),p(i.onTimeUpdate(d))}),b()()}e&2&&(a(),M(i.isMine()?"bg-white/90 text-telegram-primary":"bg-telegram-primary text-white"),a(3),v(i.isPlaying()?4:5),a(5),V(i.waveform()),a(2),ce("id",xe("waveform-clip-",i.instanceId)),a(),q("width",i.progressPercentage()+"%"),a(),q("clip-path","url(#waveform-clip-"+i.instanceId+")"),a(),V(i.waveform()),a(2),Q("opacity-100",i.isPlaying())("opacity-0",!i.isPlaying()),q("cx",i.progressPercentage()+"%")("fill",i.playedColor()),a(),M(i.isMine()?"text-white/70":"text-gray-400 dark:text-gray-500"),a(2),T(i.formatTime(i.isPlaying()?i.currentTime():i.durationMs()/1e3)),a(),M(i.isMine()?"bg-white/20 text-white":"bg-gray-200 dark:bg-gray-700"),a(2),R(" ",i.playbackSpeed(),"x "),a(),ce("src",i.audioUrl()))},encapsulation:2})}};var ze=(o,t)=>t.id;function He(o,t){if(o&1){let e=E();C(0,"button",9),B("click",function(){let n=m(e).$implicit,r=s();return p(r.activeCategory.set(n.id))}),j(1,"i"),b()}if(o&2){let e=t.$implicit,i=s();M(i.activeCategory()===e.id?"text-telegram-primary bg-telegram-primary/10":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"),a(),M("ph "+e.icon)}}function Oe(o,t){if(o&1){let e=E();C(0,"button",11),B("click",function(){let n=m(e).$implicit,r=s(2);return p(r.selectEmoji(n))}),u(1),b()}if(o&2){let e=t.$implicit;a(),R(" ",e," ")}}function Xe(o,t){if(o&1&&(C(0,"div",8),P(1,Oe,2,1,"button",10,O),b()),o&2){let e=s();a(),V(e.filteredEmojis())}}function Ge(o,t){if(o&1){let e=E();C(0,"button",11),B("click",function(){let n=m(e).$implicit,r=s(3);return p(r.selectEmoji(n))}),u(1),b()}if(o&2){let e=t.$implicit;a(),R(" ",e," ")}}function qe(o,t){if(o&1&&(C(0,"div",12),u(1,"Recently Used"),b(),C(2,"div",8),P(3,Ge,2,1,"button",10,O),b()),o&2){let e=s(2);a(3),V(e.recentEmojis())}}function Qe(o,t){if(o&1){let e=E();C(0,"button",11),B("click",function(){let n=m(e).$implicit,r=s(3);return p(r.selectEmoji(n))}),u(1),b()}if(o&2){let e=t.$implicit;a(),R(" ",e," ")}}function Ye(o,t){if(o&1&&(C(0,"div",8),P(1,Qe,2,1,"button",10,O),b()),o&2){let e=s(2);a(),V(e.currentCategoryEmojis())}}function Je(o,t){if(o&1&&_(0,qe,5,0)(1,Ye,3,0,"div",8),o&2){let e=s();v(e.activeCategory()==="recent"?0:1)}}var Ke=[{id:"recent",label:"Recent",icon:"ph-clock"},{id:"smileys",label:"Smileys",icon:"ph-smiley"},{id:"hearts",label:"Hearts",icon:"ph-heart"},{id:"hands",label:"Hands",icon:"ph-hand-waving"},{id:"animals",label:"Animals",icon:"ph-cat"},{id:"food",label:"Food",icon:"ph-hamburger"},{id:"objects",label:"Objects",icon:"ph-lightbulb"},{id:"symbols",label:"Symbols",icon:"ph-star"}],Ve={smileys:["\u{1F600}","\u{1F603}","\u{1F604}","\u{1F601}","\u{1F606}","\u{1F605}","\u{1F923}","\u{1F602}","\u{1F642}","\u{1F60A}","\u{1F607}","\u{1F970}","\u{1F60D}","\u{1F929}","\u{1F618}","\u{1F617}","\u{1F61A}","\u{1F619}","\u{1F972}","\u{1F60B}","\u{1F61B}","\u{1F61C}","\u{1F92A}","\u{1F61D}","\u{1F911}","\u{1F917}","\u{1F92D}","\u{1FAE2}","\u{1F92B}","\u{1F914}","\u{1FAE1}","\u{1F910}","\u{1F928}","\u{1F610}","\u{1F611}","\u{1F636}","\u{1FAE0}","\u{1F60F}","\u{1F612}","\u{1F644}","\u{1F62C}","\u{1F925}","\u{1F60C}","\u{1F614}","\u{1F62A}","\u{1F924}","\u{1F634}","\u{1F637}","\u{1F912}","\u{1F915}","\u{1F922}","\u{1F92E}","\u{1F975}","\u{1F976}","\u{1F974}","\u{1F635}","\u{1F92F}","\u{1F920}","\u{1F973}","\u{1F978}","\u{1F60E}","\u{1F913}","\u{1F9D0}","\u{1F615}","\u{1FAE4}","\u{1F61F}","\u{1F641}","\u{1F62E}","\u{1F62F}","\u{1F632}","\u{1F633}","\u{1F97A}","\u{1F979}","\u{1F626}","\u{1F627}","\u{1F628}","\u{1F630}","\u{1F625}","\u{1F622}","\u{1F62D}","\u{1F631}","\u{1F616}","\u{1F623}","\u{1F61E}","\u{1F613}","\u{1F629}","\u{1F62B}","\u{1F971}"],hearts:["\u2764\uFE0F","\u{1F9E1}","\u{1F49B}","\u{1F49A}","\u{1F499}","\u{1F49C}","\u{1F5A4}","\u{1F90D}","\u{1F90E}","\u{1F494}","\u2764\uFE0F\u200D\u{1F525}","\u2764\uFE0F\u200D\u{1FA79}","\u{1F495}","\u{1F49E}","\u{1F493}","\u{1F497}","\u{1F496}","\u{1F498}","\u{1F49D}","\u{1F49F}","\u2665\uFE0F","\u{1FAF6}","\u{1FAC0}","\u{1F491}","\u{1F48F}","\u{1F60D}","\u{1F970}","\u{1F618}","\u{1F63B}","\u{1F48C}"],hands:["\u{1F44B}","\u{1F91A}","\u{1F590}\uFE0F","\u270B","\u{1F596}","\u{1FAF1}","\u{1FAF2}","\u{1FAF3}","\u{1FAF4}","\u{1F44C}","\u{1F90C}","\u{1F90F}","\u270C\uFE0F","\u{1F91E}","\u{1FAF0}","\u{1F91F}","\u{1F918}","\u{1F919}","\u{1F448}","\u{1F449}","\u{1F446}","\u{1F595}","\u{1F447}","\u261D\uFE0F","\u{1FAF5}","\u{1F44D}","\u{1F44E}","\u270A","\u{1F44A}","\u{1F91B}","\u{1F91C}","\u{1F44F}","\u{1F64C}","\u{1FAF6}","\u{1F450}","\u{1F932}","\u{1F91D}","\u{1F64F}","\u270D\uFE0F","\u{1F4AA}","\u{1FAF5}"],animals:["\u{1F436}","\u{1F431}","\u{1F42D}","\u{1F439}","\u{1F430}","\u{1F98A}","\u{1F43B}","\u{1F43C}","\u{1F43B}\u200D\u2744\uFE0F","\u{1F428}","\u{1F42F}","\u{1F981}","\u{1F42E}","\u{1F437}","\u{1F438}","\u{1F435}","\u{1F648}","\u{1F649}","\u{1F64A}","\u{1F412}","\u{1F414}","\u{1F427}","\u{1F426}","\u{1F424}","\u{1F423}","\u{1F425}","\u{1F986}","\u{1F985}","\u{1F989}","\u{1F987}","\u{1F43A}","\u{1F417}","\u{1F434}","\u{1F984}","\u{1F41D}","\u{1F41B}","\u{1F98B}","\u{1F40C}","\u{1F41E}","\u{1F41C}","\u{1FAB2}","\u{1F422}","\u{1F40D}"],food:["\u{1F34E}","\u{1F350}","\u{1F34A}","\u{1F34B}","\u{1F34C}","\u{1F349}","\u{1F347}","\u{1F353}","\u{1FAD0}","\u{1F348}","\u{1F352}","\u{1F351}","\u{1F96D}","\u{1F34D}","\u{1F965}","\u{1F95D}","\u{1F345}","\u{1F346}","\u{1F951}","\u{1F966}","\u{1F96C}","\u{1F952}","\u{1F336}\uFE0F","\u{1FAD1}","\u{1F33D}","\u{1F955}","\u{1FAD2}","\u{1F9C4}","\u{1F9C5}","\u{1F954}","\u{1F360}","\u{1F950}","\u{1F96F}","\u{1F35E}","\u{1F956}","\u{1F968}","\u{1F9C0}","\u{1F95A}","\u{1F373}","\u{1F95E}","\u{1F9C7}","\u{1F953}","\u{1F969}","\u{1F357}","\u{1F356}","\u{1F32D}","\u{1F354}","\u{1F35F}","\u{1F355}","\u{1FAD3}","\u{1F96A}"],objects:["\u231A","\u{1F4F1}","\u{1F4BB}","\u2328\uFE0F","\u{1F5A5}\uFE0F","\u{1F5A8}\uFE0F","\u{1F5B1}\uFE0F","\u{1F5B2}\uFE0F","\u{1F579}\uFE0F","\u{1F5DC}\uFE0F","\u{1F4BE}","\u{1F4BF}","\u{1F4C0}","\u{1F4FC}","\u{1F4F7}","\u{1F4F8}","\u{1F4F9}","\u{1F3A5}","\u{1F4FD}\uFE0F","\u{1F39E}\uFE0F","\u{1F4DE}","\u260E\uFE0F","\u{1F4DF}","\u{1F4E0}","\u{1F4FA}","\u{1F4FB}","\u{1F399}\uFE0F","\u{1F39A}\uFE0F","\u{1F39B}\uFE0F","\u{1F9ED}","\u23F1\uFE0F","\u23F2\uFE0F","\u23F0","\u{1F570}\uFE0F","\u{1F4A1}","\u{1F526}","\u{1F56F}\uFE0F","\u{1FA94}","\u{1F9EF}","\u{1F6E2}\uFE0F","\u{1F4B8}","\u{1F4B5}","\u{1F4B4}","\u{1F4B6}","\u{1F4B7}","\u{1FA99}","\u{1F4B0}","\u{1F4B3}"],symbols:["\u2764\uFE0F","\u{1F525}","\u2B50","\u2728","\u{1F4AB}","\u{1F31F}","\u{1F4AF}","\u2705","\u274C","\u26A1","\u{1F4A5}","\u{1F4A2}","\u{1F4A4}","\u{1F4A8}","\u{1F3B5}","\u{1F3B6}","\u{1F511}","\u{1F512}","\u{1F513}","\u{1F3F3}\uFE0F","\u{1F3F4}","\u{1F6A9}","\u{1F38C}","\u{1F3C1}","\u267B\uFE0F","\u{1F4A0}","\u{1F530}","\u269C\uFE0F","\u{1F531}","\u{1F4DB}","\u{1F534}","\u{1F7E0}","\u{1F7E1}","\u{1F7E2}","\u{1F535}","\u{1F7E3}","\u26AB","\u26AA","\u{1F7E4}","\u{1F536}","\u{1F537}","\u{1F538}","\u{1F539}","\u{1F53A}","\u{1F53B}"]},We=Object.values(Ve).flat(),ne=class o{constructor(){this.emojiSelected=_e();this.categories=Ke;this.activeCategory=k("smileys");this.searchQuery=k("");this.recentEmojis=k(["\u{1F600}","\u2764\uFE0F","\u{1F44D}","\u{1F525}","\u{1F602}","\u{1F389}","\u2728","\u{1F64F}","\u{1F60D}","\u{1F4AF}"]);this.filteredEmojis=D(()=>this.searchQuery()?We:[]);this.currentCategoryEmojis=D(()=>Ve[this.activeCategory()]||[])}onSearch(t){this.searchQuery.set(t.target.value)}selectEmoji(t){this.recentEmojis.update(e=>[t,...e.filter(i=>i!==t)].slice(0,30)),this.emojiSelected.emit(t)}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=N({type:o,selectors:[["app-emoji-picker"]],outputs:{emojiSelected:"emojiSelected"},decls:11,vars:1,consts:[[1,"flex","flex-col","bg-white","dark:bg-telegram-surface","rounded-2xl","shadow-2xl","border","border-gray-200","dark:border-gray-700/50","overflow-hidden","w-full","max-w-[360px]","min-w-[280px]",2,"height","380px",3,"click"],[1,"px-3","pt-3","pb-2"],[1,"relative"],[1,"ph","ph-magnifying-glass","absolute","left-2.5","top-1/2","-translate-y-1/2","text-gray-400","text-sm"],["type","text","placeholder","Search emoji...",1,"w-full","bg-gray-100","dark:bg-gray-800","text-sm","rounded-lg","py-1.5","pl-8","pr-3","outline-none","text-black","dark:text-white","placeholder-gray-400",3,"input"],[1,"flex","px-2","gap-0.5","border-b","border-gray-100","dark:border-gray-700/50"],[1,"flex-1","py-1.5","flex","justify-center","items-center","rounded-t-lg","transition-colors","text-sm",3,"class"],[1,"flex-1","overflow-y-auto","no-scrollbar","p-2"],[1,"grid","grid-cols-8","gap-0.5"],[1,"flex-1","py-1.5","flex","justify-center","items-center","rounded-t-lg","transition-colors","text-sm",3,"click"],[1,"w-9","h-9","flex","items-center","justify-center","text-xl","rounded-lg","hover:bg-gray-100","dark:hover:bg-gray-700","transition-colors","active:scale-90"],[1,"w-9","h-9","flex","items-center","justify-center","text-xl","rounded-lg","hover:bg-gray-100","dark:hover:bg-gray-700","transition-colors","active:scale-90",3,"click"],[1,"text-xs","text-gray-400","px-1","pb-1","font-medium"]],template:function(e,i){e&1&&(C(0,"div",0),B("click",function(r){return r.stopPropagation()}),C(1,"div",1)(2,"div",2),j(3,"i",3),C(4,"input",4),B("input",function(r){return i.onSearch(r)}),b()()(),C(5,"div",5),P(6,He,2,4,"button",6,ze),b(),C(8,"div",7),_(9,Xe,3,0,"div",8)(10,Je,2,1),b()()),e&2&&(a(6),V(i.categories),a(3),v(i.searchQuery()?9:10))},encapsulation:2})}};var oe=class o{static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=N({type:o,selectors:[["app-typing-indicator"]],decls:6,vars:0,consts:[[1,"flex","items-end","gap-1","self-start","max-w-[80%]"],[1,"px-4","py-3","rounded-2xl","rounded-bl-sm","bg-white","dark:bg-telegram-surface","border","border-gray-100","dark:border-gray-800","shadow-sm"],[1,"flex","items-center","gap-1.5","h-4"],[1,"w-2","h-2","rounded-full","bg-gray-400","dark:bg-gray-500","animate-typing-dot-1"],[1,"w-2","h-2","rounded-full","bg-gray-400","dark:bg-gray-500","animate-typing-dot-2"],[1,"w-2","h-2","rounded-full","bg-gray-400","dark:bg-gray-500","animate-typing-dot-3"]],template:function(e,i){e&1&&(C(0,"div",0)(1,"div",1)(2,"div",2),j(3,"span",3)(4,"span",4)(5,"span",5),b()()())},encapsulation:2})}};var re=class o{constructor(){this.label=G.required()}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=N({type:o,selectors:[["app-date-separator"]],inputs:{label:[1,"label"]},decls:3,vars:1,consts:[[1,"flex","items-center","justify-center","py-2","sticky","top-0","z-10"],[1,"px-3","py-1","rounded-full","text-xs","font-medium","bg-black/10","dark:bg-white/10","text-gray-600","dark:text-gray-300","backdrop-blur-md","shadow-sm"]],template:function(e,i){e&1&&(C(0,"div",0)(1,"div",1),u(2),b()()),e&2&&(a(2),R(" ",i.label()," "))},encapsulation:2})}};var Ze=["messagesContainer"],et=["messageInput"],tt=["sendBtn"],it=["micBtn"],nt=["peerProfileTrigger"],ot=(o,t)=>t.key,Be=(o,t)=>t.emoji;function rt(o,t){if(o&1&&f(0,"app-date-separator",35),o&2){let e=s().$implicit;$("label",e.dateLabel)}}function at(o,t){if(o&1){let e=E();l(0,"div",46),x("click",function(){m(e),s(2);let n=w(0),r=s(2);return p(r.scrollToMessage(n.replyToId))}),f(1,"div",47),l(2,"div",48)(3,"div",49),u(4),c(),l(5,"div",50),u(6),c()()()}if(o&2){let e;s();let i=w(0);s();let n=w(1),r=s(2);M(n?"bg-white/10":"bg-telegram-primary/10"),a(),M(n?"bg-white/50":"bg-telegram-primary"),a(2),M(n?"text-white/80":"text-telegram-primary"),a(),R(" ",((e=r.chatService.getUserById(i.senderId))==null?null:e.name)||"User"," "),a(2),T(i.text==null?null:i.text.substring(0,50))}}function lt(o,t){if(o&1&&(Y(0),_(1,at,7,8,"div",45)),o&2){s();let e=w(0),i=X(s(2).chatService.getMessageById(e.replyToId));a(),v(i?1:-1)}}function st(o,t){if(o&1&&(l(0,"div",39),u(1),c()),o&2){let e;s();let i=w(0),n=s(2);a(),R(" ",(e=n.chatService.getUserById(i.senderId))==null?null:e.name," ")}}function ct(o,t){if(o&1&&f(0,"app-voice-player",40),o&2){s();let e=w(0),i=w(1);$("audioUrl",e.voice.url)("durationMs",e.voice.durationMs)("waveform",e.voice.waveform)("isMine",i)}}function dt(o,t){if(o&1&&(l(0,"p",41),u(1),c()),o&2){s();let e=w(0);$("id","text-"+e.id),a(),T(e.text)}}function mt(o,t){o&1&&f(0,"i",51)}function pt(o,t){o&1&&f(0,"i",52)}function ut(o,t){o&1&&f(0,"i",53)}function gt(o,t){o&1&&f(0,"i",54)}function ht(o,t){if(o&1&&_(0,mt,1,0,"i",51)(1,pt,1,0,"i",52)(2,ut,1,0,"i",53)(3,gt,1,0,"i",54),o&2){s();let e=w(0);v(e.status==="sending"?0:e.status==="sent"?1:e.status==="delivered"?2:e.status==="seen"?3:-1)}}function ft(o,t){if(o&1){let e=E();l(0,"button",57),x("click",function(n){let r=m(e).$implicit;s(2);let d=w(0),h=s(2);return p(h.toggleReaction(d.id,r.emoji,n))}),l(1,"span"),u(2),c(),l(3,"span",58),u(4),c()()}if(o&2){let e=t.$implicit,i=s(4);M(e.userIds.includes(i.chatService.currentUser().id)?"bg-telegram-primary/20 border-telegram-primary/40 text-telegram-primary":"bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700"),a(2),T(e.emoji),a(2),T(e.userIds.length)}}function xt(o,t){if(o&1&&(l(0,"div",55),P(1,ft,5,4,"button",56,Be),c()),o&2){s();let e=w(0),i=w(1);Q("self-end",i)("self-start",!i),a(),V(e.reactions)}}function _t(o,t){if(o&1){let e=E();Y(0)(1),l(2,"div",37),x("touchstart",function(n){m(e);let r=w(0),d=s(2);return p(d.onTouchStart(n,r))})("touchmove",function(n){m(e);let r=w(0),d=s(2);return p(d.onTouchMove(n,r))})("touchend",function(n){m(e);let r=w(0),d=s(2);return p(d.onTouchEnd(n,r))})("contextmenu",function(n){m(e);let r=w(0),d=s(2);return p(d.onContextMenu(n,r))}),_(3,lt,2,2),l(4,"div",38),_(5,st,2,1,"div",39),_(6,ct,1,4,"app-voice-player",40),_(7,dt,2,2,"p",41),l(8,"div",42)(9,"span",43),u(10),de(11,"shortTime"),c(),_(12,ht,4,1),c()(),_(13,xt,3,4,"div",44),c()}if(o&2){let e,i=s().$implicit,n=s(),r=X(i.message);a();let d=X(r.senderId===n.chatService.currentUser().id),h=i.showTail,g=i.isGrouped;a(),Z("transform",n.swipingMsgId()===r.id?"translateX("+n.swipeX()+"px)":"translateX(0px)")("opacity",r.isAnimating?"0":"1"),Q("self-end",d)("self-start",!d)("max-w-[80%]",!0)("mt-0",g)("mt-2",!g),$("id","msg-"+r.id),a(),v(r.replyToId?3:-1),a(),M(d?"bg-telegram-primary text-white "+(h?"rounded-2xl rounded-br-sm":"rounded-2xl"):"bg-white dark:bg-telegram-surface text-black dark:text-white "+(h?"rounded-2xl rounded-bl-sm":"rounded-2xl")+" border border-gray-100 dark:border-gray-800/50"),a(),v(!d&&(((e=n.chat())==null?null:e.type)==="group"||((e=n.chat())==null?null:e.type)==="channel")&&!g?5:-1),a(),v(r.voice?6:-1),a(),v(r.text?7:-1),a(),M(d?"text-white/60":"text-telegram-muted"),a(2),T(me(11,28,r.timestamp)),a(2),v(d?12:-1),a(),v(r.reactions&&r.reactions.length>0?13:-1)}}function vt(o,t){if(o&1&&_(0,rt,1,1,"app-date-separator",35)(1,_t,14,30,"div",36),o&2){let e=t.$implicit;v(e.type==="date"?0:e.type==="message"?1:-1)}}function Ct(o,t){o&1&&f(0,"app-typing-indicator")}function yt(o,t){if(o&1){let e=E();l(0,"button",59),x("click",function(){m(e);let n=s();return p(n.scrollToBottom())}),f(1,"i",60),c()}}function bt(o,t){if(o&1&&(l(0,"div",39),u(1),c()),o&2){let e;s();let i=w(0),n=s();a(),R(" ",(e=n.chatService.getUserById(i.senderId))==null?null:e.name," ")}}function wt(o,t){if(o&1&&f(0,"app-voice-player",40),o&2){s();let e=w(0),i=w(1);$("audioUrl",e.voice.url)("durationMs",e.voice.durationMs)("waveform",e.voice.waveform)("isMine",i)}}function kt(o,t){if(o&1&&(l(0,"p",65),u(1),c()),o&2){s();let e=w(0);a(),T(e.text)}}function Et(o,t){if(o&1&&(l(0,"span",77)(1,"span"),u(2),c(),l(3,"span",58),u(4),c()()),o&2){let e=t.$implicit,i=s(3);M(e.userIds.includes(i.chatService.currentUser().id)?"bg-telegram-primary/20 border-telegram-primary/40 text-telegram-primary":"bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700"),a(2),T(e.emoji),a(2),T(e.userIds.length)}}function St(o,t){if(o&1&&(l(0,"div",55),P(1,Et,5,4,"span",76,Be),c()),o&2){s();let e=w(0);a(),V(e.reactions)}}function Tt(o,t){if(o&1){let e=E();l(0,"button",78),x("click",function(){let n=m(e).$implicit,r=s(2);return p(r.onContextReaction(n))}),u(1),c()}if(o&2){let e=t.$implicit;a(),R(" ",e," ")}}function Mt(o,t){if(o&1){let e=E();Y(0)(1),l(2,"div",61),x("click",function(){m(e);let n=s();return p(n.closeContextPreview())}),l(3,"div",62),x("click",function(n){return m(e),p(n.stopPropagation())}),l(4,"div",63)(5,"div",64),_(6,bt,2,1,"div",39),_(7,wt,1,4,"app-voice-player",40),_(8,kt,2,1,"p",65),l(9,"div",42)(10,"span",43),u(11),de(12,"shortTime"),c()()(),_(13,St,3,0,"div",55),c(),l(14,"div",66),P(15,Tt,2,1,"button",67,fe),c(),l(17,"div",68)(18,"div",69)(19,"button",70),x("click",function(){m(e);let n=s();return p(n.onContextAction("reply"))}),f(20,"i",71),l(21,"span"),u(22,"Reply"),c()(),l(23,"button",70),x("click",function(){m(e);let n=s();return p(n.onContextAction("forward"))}),f(24,"i",72),l(25,"span"),u(26,"Forward"),c()(),l(27,"button",70),x("click",function(){m(e);let n=s();return p(n.onContextAction("copy"))}),f(28,"i",73),l(29,"span"),u(30,"Copy"),c()(),l(31,"button",74),x("click",function(){m(e);let n=s();return p(n.onContextAction("delete"))}),f(32,"i",75),l(33,"span"),u(34,"Delete"),c()()()()()()}if(o&2){let e,i=s(),n=X(i.contextMenuMsg());a();let r=X(n.senderId===i.chatService.currentUser().id);a(4),M(r?"bg-telegram-primary text-white rounded-2xl rounded-br-sm":"bg-white dark:bg-telegram-surface text-black dark:text-white rounded-2xl rounded-bl-sm border border-gray-100 dark:border-gray-800/50"),a(),v(!r&&(((e=i.chat())==null?null:e.type)==="group"||((e=i.chat())==null?null:e.type)==="channel")?6:-1),a(),v(n.voice?7:-1),a(),v(n.text?8:-1),a(),M(r?"text-white/60":"text-telegram-muted"),a(2),T(me(12,11,n.timestamp)),a(2),v(n.reactions&&n.reactions.length>0?13:-1),a(2),V(i.contextReactionEmojis)}}function It(o,t){if(o&1&&f(0,"img",88),o&2){s();let e=w(0);$("src",e.avatarUrl,ge)}}function Rt(o,t){if(o&1&&(l(0,"div",89),u(1),c()),o&2){s();let e=w(0),i=s();a(),R(" ",i.profileInitial(e.name)," ")}}function Pt(o,t){if(o&1){let e=E();Y(0),l(1,"div",79),x("click",function(){m(e);let n=s();return p(n.closePeerProfileCard())}),l(2,"div",80),x("click",function(n){return m(e),p(n.stopPropagation())}),l(3,"div",81)(4,"div",82)(5,"span",83),u(6,"Profile"),c(),l(7,"button",84),x("click",function(){m(e);let n=s();return p(n.closePeerProfileCard())}),f(8,"i",85),c()(),l(9,"div",86)(10,"div",87),_(11,It,1,1,"img",88)(12,Rt,2,1,"div",89),c(),l(13,"div",90)(14,"div",49),u(15),c(),l(16,"div",91),u(17),c()()(),l(18,"div",92)(19,"span",93),u(20,"Name"),c(),l(21,"div",94),u(22),c()(),l(23,"div",92)(24,"span",93),u(25,"Username"),c(),l(26,"div",95),u(27),c()(),l(28,"div",92)(29,"span",93),u(30,"Bio"),c(),l(31,"p",96),u(32),c()()()()()}if(o&2){let e=X(s().peerProfile());a(11),v(e.avatarUrl?11:12),a(4),T(e.name),a(2),T(e.status),a(5),T(e.name),a(5),T("@"+e.username),a(5),T(e.bio)}}function Vt(o,t){if(o&1){let e=E();l(0,"div",97)(1,"app-emoji-picker",98),x("emojiSelected",function(n){m(e);let r=s();return p(r.onEmojiSelected(n))}),c()(),l(2,"div",99),x("click",function(){m(e);let n=s();return p(n.showEmojiPicker.set(!1))}),c()}}function jt(o,t){if(o&1){let e=E();l(0,"div",22),f(1,"div",100),l(2,"div",101)(3,"div",102),u(4),c(),l(5,"div",103),u(6),c()(),l(7,"button",104),x("click",function(){m(e);let n=s();return p(n.cancelReply())}),f(8,"i",85),c()()}if(o&2){let e,i,n=s();a(4),T((e=n.chatService.getUserById(n.replyingTo().senderId))==null?null:e.name),a(2),T(((i=n.replyingTo().text)==null?null:i.substring(0,60))||"Voice message")}}function Bt(o,t){if(o&1){let e=E();l(0,"div",23),f(1,"div",105),l(2,"div",106)(3,"button",107),x("click",function(){m(e);let n=s();return p(n.toggleAttachmentPanel())}),l(4,"div",108),f(5,"i",109),c(),l(6,"span",110),u(7,"Gallery"),c()(),l(8,"button",107),x("click",function(){m(e);let n=s();return p(n.toggleAttachmentPanel())}),l(9,"div",111),f(10,"i",112),c(),l(11,"span",110),u(12,"File"),c()(),l(13,"button",107),x("click",function(){m(e);let n=s();return p(n.toggleAttachmentPanel())}),l(14,"div",113),f(15,"i",114),c(),l(16,"span",110),u(17,"Location"),c()(),l(18,"button",107),x("click",function(){m(e);let n=s();return p(n.toggleAttachmentPanel())}),l(19,"div",115),f(20,"i",116),c(),l(21,"span",110),u(22,"Cancel"),c()()()()}}function Dt(o,t){if(o&1&&(l(0,"div",29)(1,"div",117),f(2,"div",118),l(3,"span",119),u(4),c()(),l(5,"span",93),u(6,"\u2190 Slide to cancel"),c()()),o&2){let e=s();a(4),T(e.formatDuration(e.voiceRecorder.recordingDuration()))}}function Lt(o,t){if(o&1){let e=E();l(0,"textarea",120,3),x("ngModelChange",function(n){m(e);let r=s();return p(r.onInputTextChange(n))})("input",function(n){m(e);let r=s();return p(r.autoGrow(n))})("keydown.enter",function(n){m(e);let r=s();return p(r.handleEnter(n))}),c()}if(o&2){let e=s();$("ngModel",e.inputText())}}function At(o,t){if(o&1){let e=E();l(0,"div",34)(1,"button",121),x("click",function(){m(e);let n=s();return p(n.cancelRecording())}),f(2,"i",122),c(),l(3,"button",123),x("click",function(){m(e);let n=s();return p(n.stopAndSendRecording())}),f(4,"i",124),c()()}}function Nt(o,t){if(o&1){let e=E();l(0,"button",125,4),x("click",function(){m(e);let n=s();return p(n.initiateSendMessage())}),f(2,"i",124),c(),l(3,"button",126,5),x("click",function(){m(e);let n=s();return p(n.startRecording())}),f(5,"i",127),c()}}var Ft=["\u2764\uFE0F","\u{1F44D}","\u{1F602}","\u{1F62E}","\u{1F622}","\u{1F64F}"],je=class o{constructor(){this.chatService=A(Ee);this.voiceRecorder=A(ee);this.animationService=A(ye);this.audioService=A(ke);this.themeService=A(be);this.route=A(ve);this.router=A(Ce);this.messagesContainer=F("messagesContainer");this.messageInput=F("messageInput");this.sendBtn=F("sendBtn");this.micBtn=F("micBtn");this.peerProfileTrigger=F("peerProfileTrigger");this.chatId="";this.inputText=k("");this.hasText=k(!1);this.showEmojiPicker=k(!1);this.showScrollBtn=k(!1);this.showAttachmentPanel=k(!1);this.replyingTo=k(null);this.pendingAttachments=[];this.contextMenuMsg=k(null);this.contextReactionEmojis=Ft;this.isClosingContextPreview=!1;this.showPeerProfileCard=k(!1);this.isClosingPeerProfileCard=!1;this.Math=Math;this.swipingMsgId=k(null);this.swipeX=k(0);this.swipeStartX=0;this.swipeStartY=0;this.swipeDirectionLocked=null;this.scrollRafId=null;this.chat=D(()=>this.chatService.getChatById(this.chatId));this.participant=D(()=>{let t=this.chat();return t?this.chatService.getParticipant(t):void 0});this.messages=D(()=>this.chatService.getMessagesForChat(this.chatId)());this.isTyping=D(()=>this.chatService.getTypingUsersForChat(this.chatId).length>0);this.statusString=D(()=>{let t=this.chat();if(!t)return"";let e=this.chatService.getTypingUsersForChat(this.chatId);return e.length>0?t.type==="direct"?"typing...":e.map(n=>this.chatService.getUserById(n)?.name?.split(" ")[0]).filter(Boolean).join(", ")+" typing...":t.type==="group"?`${t.memberCount||t.participants.length} members`:t.type==="channel"?`${t.memberCount?.toLocaleString()} subscribers`:this.participant()?.isOnline?"online":"last seen recently"});this.peerProfile=D(()=>{let t=this.chat();if(!t)return null;if(t.type==="direct"){let n=this.participant();return n?{name:n.name||"User",username:this.normalizeProfileHandle(n.username||n.name||"user"),bio:n.bio||"No bio yet",avatarUrl:n.avatarUrl,status:n.isOnline?"online":"last seen recently"}:null}let e=t.memberCount||t.participants.length,i=t.type==="group"?`${e} members`:`${t.memberCount?.toLocaleString()||0} subscribers`;return{name:t.name||"Chat",username:this.normalizeProfileHandle(t.name||t.id||"chat"),bio:t.description||i,avatarUrl:t.avatarUrl,status:i}});this.displayItems=D(()=>{let t=this.messages(),e=[],i="",n="";for(let r=0;r<t.length;r++){let d=t[r],h=this.getDateLabel(d.timestamp);h!==i&&(e.push({type:"date",key:"date-"+h,dateLabel:h}),i=h,n="");let g=d.senderId===n,S=t[r+1],y=!S||S.senderId!==d.senderId||this.getDateLabel(S.timestamp)!==h;e.push({type:"message",key:d.id,message:d,isGrouped:g,showTail:y}),n=d.senderId}return e});this.messageCount=0;this.scrollHandler=()=>{this.scrollRafId||(this.scrollRafId=requestAnimationFrame(()=>{this.scrollRafId=null;let t=this.messagesContainer()?.nativeElement;if(!t)return;let e=t.scrollHeight-t.scrollTop-t.clientHeight;this.showScrollBtn.set(e>200)}))};this.routeSub=this.route.params.subscribe(t=>{this.chatId=t.id,this.chatService.markAsRead(this.chatId),he(()=>{this.scrollToBottom(),this.animationService.pageTransitionIn("#chat-room-container"),this.messageCount=this.messages().length,this.attachScrollListener()})}),se(()=>{let t=this.hasText()||this.pendingAttachments.length>0,e=this.sendBtn()?.nativeElement,i=this.micBtn()?.nativeElement;e&&i&&(this.animationService.toggleActionButtons(t,e,i),e.style.pointerEvents=t?"auto":"none",i.style.pointerEvents=t?"none":"auto")}),se(()=>{let t=this.messages();t.length>this.messageCount&&(this.messageCount=t.length,setTimeout(()=>this.scrollToBottom(),50))})}ngOnDestroy(){this.routeSub?.unsubscribe(),this.scrollRafId&&cancelAnimationFrame(this.scrollRafId);let t=this.messagesContainer()?.nativeElement;t&&t.removeEventListener("scroll",this.scrollHandler)}attachScrollListener(){let t=this.messagesContainer()?.nativeElement;t&&t.addEventListener("scroll",this.scrollHandler,{passive:!0})}getDateLabel(t){let e=new Date(t),i=new Date,n=i.getTime()-e.getTime();return n<864e5&&e.getDate()===i.getDate()?"Today":n<1728e5?"Yesterday":e.toLocaleDateString("en-US",{month:"short",day:"numeric"})}onInputTextChange(t){this.inputText.set(t),this.hasText.set(t.trim().length>0)}handleEnter(t){t.preventDefault(),this.initiateSendMessage()}goBack(){this.animationService.pageTransitionOut("#chat-room-container",()=>{this.router.navigate(["/"])})}scrollToBottom(){let t=this.messagesContainer()?.nativeElement;t&&this.animationService.smoothScrollTo(t,t.scrollHeight)}scrollToMessage(t){let e=document.getElementById("msg-"+t);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),typeof gsap<"u"&&gsap.fromTo(e,{backgroundColor:"rgba(51,144,236,0.2)"},{backgroundColor:"transparent",duration:1.5,ease:"power2.out"}))}autoGrow(t){let e=t.target;e.style.height="auto",e.style.height=Math.min(e.scrollHeight,120)+"px"}toggleAttachmentPanel(){this.showAttachmentPanel.update(t=>!t),this.showAttachmentPanel()&&(this.showEmojiPicker.set(!1),setTimeout(()=>{let t=document.getElementById("attachment-panel");t&&this.animationService.slideInFromBottom(t,200)},0))}toggleEmojiPicker(){this.showEmojiPicker.update(t=>!t),this.showEmojiPicker()&&(this.showAttachmentPanel.set(!1),setTimeout(()=>{let t=document.getElementById("emoji-picker-panel");t&&this.animationService.slideInFromBottom(t,200)},0))}onEmojiSelected(t){this.inputText.update(e=>e+t),this.hasText.set(!0)}openPeerProfile(t){this.showPeerProfileCard()||this.peerProfile()&&(this.showEmojiPicker.set(!1),this.showAttachmentPanel.set(!1),this.contextMenuMsg.set(null),this.showPeerProfileCard.set(!0),this.isClosingPeerProfileCard=!1,setTimeout(()=>this.animatePeerProfileIn(t.currentTarget),0))}closePeerProfileCard(){if(!this.showPeerProfileCard()||this.isClosingPeerProfileCard)return;let t=document.getElementById("peer-profile-backdrop"),e=document.getElementById("peer-profile-card"),i=document.getElementById("peer-profile-avatar"),n=this.peerProfileTrigger()?.nativeElement;if(typeof gsap>"u"||!t||!e){this.showPeerProfileCard.set(!1),this.isClosingPeerProfileCard=!1;return}this.isClosingPeerProfileCard=!0;let r=gsap.timeline({defaults:{overwrite:"auto"},onComplete:()=>{this.showPeerProfileCard.set(!1),this.isClosingPeerProfileCard=!1}});if(i&&n){let d=i.getBoundingClientRect(),h=n.getBoundingClientRect(),g=i.cloneNode(!0);g.querySelectorAll("[id]").forEach(S=>S.removeAttribute("id")),g.style.position="fixed",g.style.left=`${d.left}px`,g.style.top=`${d.top}px`,g.style.width=`${d.width}px`,g.style.height=`${d.height}px`,g.style.pointerEvents="none",g.style.margin="0",g.style.zIndex="102",g.style.borderRadius="9999px",g.style.overflow="hidden",g.style.willChange="left, top, width, height, opacity",document.body.appendChild(g),r.to(e,{opacity:0,y:14,scale:.96,duration:.16,ease:"power2.in"},0).to(g,{left:h.left,top:h.top,width:h.width,height:h.height,opacity:0,duration:.2,ease:"power2.inOut",onComplete:()=>g.remove()},.04).to(t,{opacity:0,duration:.18,ease:"power1.out"},0);return}r.to(e,{opacity:0,y:14,scale:.96,duration:.16,ease:"power2.in"},0).to(t,{opacity:0,duration:.18,ease:"power1.out"},0)}profileInitial(t){return(t||"U").trim().charAt(0).toUpperCase()||"U"}normalizeProfileHandle(t){return t.replace(/^@+/,"").replace(/\s+/g,"_").toLowerCase()||"user"}animatePeerProfileIn(t){let e=document.getElementById("peer-profile-backdrop"),i=document.getElementById("peer-profile-card"),n=document.getElementById("peer-profile-island"),r=document.getElementById("peer-profile-avatar");if(!e||!i||!n||typeof gsap>"u")return;gsap.set(e,{opacity:0}),gsap.set(i,{opacity:0,y:24,scale:.94});let d=gsap.timeline({defaults:{overwrite:"auto"}});if(d.to(e,{opacity:1,duration:.22,ease:"power1.out"},0),t&&r){let g=t.getBoundingClientRect(),S=r.getBoundingClientRect(),y=t.cloneNode(!0);y.querySelectorAll("[id]").forEach(L=>L.removeAttribute("id")),y.style.position="fixed",y.style.left=`${g.left}px`,y.style.top=`${g.top}px`,y.style.width=`${g.width}px`,y.style.height=`${g.height}px`,y.style.pointerEvents="none",y.style.margin="0",y.style.zIndex="102",y.style.borderRadius="9999px",y.style.overflow="hidden",y.style.willChange="left, top, width, height, opacity",document.body.appendChild(y),d.to(y,{left:S.left,top:S.top,width:S.width,height:S.height,opacity:0,duration:.26,ease:"power3.out",onComplete:()=>y.remove()},.04)}d.to(i,{opacity:1,y:0,scale:1,duration:.28,ease:"back.out(1.25)"},.16);let h=n.querySelectorAll(".profile-field");h.length>0&&d.fromTo(h,{opacity:0,y:12},{opacity:1,y:0,duration:.22,stagger:.04,ease:"power2.out"},.24)}onContextMenu(t,e){t.preventDefault(),this.showEmojiPicker.set(!1),this.showAttachmentPanel.set(!1),this.isClosingContextPreview=!1,this.contextMenuMsg.set(e),setTimeout(()=>this.animateContextPreview(e.id),0)}closeContextPreview(){if(!this.contextMenuMsg())return;let t=document.getElementById("context-preview-backdrop"),e=document.getElementById("context-preview-card");if(typeof gsap>"u"||!t||!e){this.contextMenuMsg.set(null),this.isClosingContextPreview=!1;return}this.isClosingContextPreview||(this.isClosingContextPreview=!0,gsap.timeline({defaults:{overwrite:"auto"},onComplete:()=>{this.contextMenuMsg.set(null),this.isClosingContextPreview=!1}}).to(e,{y:14,scale:.96,opacity:0,duration:.16,ease:"power2.in"},0).to(t,{opacity:0,duration:.14,ease:"power1.in"},0))}onContextAction(t){let e=this.contextMenuMsg();if(e){switch(t){case"reply":this.replyingTo.set(e),setTimeout(()=>{this.messageInput()?.nativeElement.focus();let i=document.getElementById("reply-bar");i&&this.animationService.slideInFromBottom(i,50)},180);break;case"copy":e.text&&navigator.clipboard.writeText(e.text).catch(()=>{});break;case"forward":this.forwardMessage(e);break;case"delete":this.chatService.deleteMessage(e.id);break}this.closeContextPreview()}}onContextReaction(t){let e=this.contextMenuMsg();if(!e)return;this.chatService.addReaction(e.id,t);let i=document.getElementById("msg-"+e.id);if(i){let n=i.getBoundingClientRect();this.animationService.confettiExplosion(n.left+n.width/2,n.top)}this.closeContextPreview()}forwardMessage(t){if(!(!!t.text||!!t.voice))return;let i="m_"+Math.random().toString(36).substring(2,9);this.chatService.addMessage({id:i,chatId:this.chatId,senderId:this.chatService.currentUser().id,text:t.text?`Forwarded:
${t.text}`:void 0,timestamp:Date.now(),status:"sent",replyToId:t.id,voice:t.voice?pe({},t.voice):void 0}),this.audioService.playSendSound(),setTimeout(()=>{this.scrollToBottom();let n=document.getElementById("msg-"+i);n&&this.animationService.popInMessage(n)},50)}animateContextPreview(t){if(typeof gsap>"u")return;let e=document.getElementById("msg-"+t),i=e?.querySelector(".group"),n=document.getElementById("context-preview-backdrop"),r=document.getElementById("context-preview-card"),d=document.getElementById("context-preview-message"),h=document.getElementById("context-preview-bubble"),g=document.getElementById("context-preview-reactions"),S=document.getElementById("context-preview-actions");if(!n||!r||!d||!h)return;if(gsap.set(n,{opacity:0}),gsap.set(r,{opacity:1,y:0,scale:1}),gsap.set(d,{opacity:0}),g&&gsap.set(g,{opacity:0,y:10}),S&&gsap.set(S,{opacity:0,y:14}),!i){let z=gsap.timeline({defaults:{overwrite:"auto"}});z.to(n,{opacity:1,duration:.2,ease:"power1.out"},0).fromTo(r,{y:26,scale:.94,opacity:0},{y:0,scale:1,opacity:1,duration:.28,ease:"back.out(1.25)"},0).to(d,{opacity:1,duration:.08,ease:"none"},.2),g&&z.to(g,{opacity:1,y:0,duration:.2,ease:"power2.out"},.26),S&&z.to(S,{opacity:1,y:0,duration:.22,ease:"power2.out"},.3);return}let y=i.getBoundingClientRect(),L=h.getBoundingClientRect(),I=i.cloneNode(!0);I.querySelectorAll("[id]").forEach(z=>z.removeAttribute("id")),I.style.position="fixed",I.style.left=`${y.left}px`,I.style.top=`${y.top}px`,I.style.width=`${y.width}px`,I.style.height=`${y.height}px`,I.style.margin="0",I.style.pointerEvents="none",I.style.zIndex="102",I.style.overflow="hidden",I.style.willChange="left, top, width, height, opacity",document.body.appendChild(I),e&&gsap.fromTo(e,{scale:1},{scale:.985,duration:.14,ease:"power1.inOut",yoyo:!0,repeat:1});let U=gsap.timeline({defaults:{overwrite:"auto"},onComplete:()=>I.remove()});U.to(n,{opacity:1,duration:.2,ease:"power1.out"},0).to(I,{left:L.left,top:L.top,width:L.width,height:L.height,borderRadius:getComputedStyle(h).borderRadius,duration:.34,ease:"power3.out"},.02).to(I,{opacity:0,duration:.12,ease:"power2.in"},.26).to(d,{opacity:1,duration:.08,ease:"none"},.28),g&&U.to(g,{opacity:1,y:0,duration:.2,ease:"power2.out"},.34),S&&U.to(S,{opacity:1,y:0,duration:.22,ease:"power2.out"},.38)}toggleReaction(t,e,i){this.chatService.addReaction(t,e),this.animationService.elasticButton(i.currentTarget)}cancelReply(){this.replyingTo.set(null)}initiateSendMessage(){let t=this.inputText().trim();if(t.length===0)return;let e=this.messageInput()?.nativeElement;if(!e)return;this.inputText.set(""),this.hasText.set(!1),e.style.height="auto",e.focus();let i="m_"+Math.random().toString(36).substring(2,9),n=this.replyingTo(),r={id:i,chatId:this.chatId,senderId:this.chatService.currentUser().id,text:t,timestamp:Date.now(),status:"sending",isAnimating:!0,replyToId:n?.id};this.replyingTo.set(null),this.showEmojiPicker.set(!1),this.chatService.addMessage(r),this.audioService.playSendSound(),setTimeout(async()=>{this.scrollToBottom();let d=document.getElementById("msg-"+i);d&&e&&await this.animationService.animateSendText({sourceTextEl:e,targetPlaceholderEl:d,text:t,isMine:!0}),this.chatService.updateMessage(i,{isAnimating:!1,status:"sent"}),setTimeout(()=>this.chatService.updateMessage(i,{status:"delivered"}),1e3),setTimeout(()=>this.chatService.updateMessage(i,{status:"seen"}),3e3)},10)}async startRecording(){await this.voiceRecorder.startRecording()}async stopAndSendRecording(){let t=await this.voiceRecorder.stopRecording();if(t&&t.durationMs>0){let e="m_"+Math.random().toString(36).substring(2,9);this.chatService.addMessage({id:e,chatId:this.chatId,senderId:this.chatService.currentUser().id,timestamp:Date.now(),status:"sent",voice:{storageKey:t.storageKey,url:t.blobUrl,duration:Math.round(t.durationMs/1e3),durationMs:t.durationMs,waveform:t.waveform}}),this.audioService.playSendSound(),setTimeout(()=>{this.scrollToBottom();let i=document.getElementById("msg-"+e);i&&this.animationService.popInMessage(i)},50)}}cancelRecording(){this.voiceRecorder.cancelRecording()}formatDuration(t){let e=Math.floor(t/60),i=Math.floor(t%60);return`${e}:${i<10?"0":""}${i}`}onTouchStart(t,e){this.swipingMsgId.set(e.id),this.swipeStartX=t.touches[0].clientX,this.swipeStartY=t.touches[0].clientY,this.swipeX.set(0),this.swipeDirectionLocked=null}onTouchMove(t,e){if(this.swipingMsgId()!==e.id)return;let i=t.touches[0].clientX-this.swipeStartX,n=t.touches[0].clientY-this.swipeStartY;if(!this.swipeDirectionLocked){(Math.abs(i)>8||Math.abs(n)>8)&&(this.swipeDirectionLocked=Math.abs(i)>Math.abs(n)?"h":"v");return}if(this.swipeDirectionLocked==="v")return;let r=e.senderId===this.chatService.currentUser().id;r&&i<0?this.swipeX.set(Math.max(i,-60)):!r&&i>0&&this.swipeX.set(Math.min(i,60))}onTouchEnd(t,e){this.swipingMsgId()===e.id&&(Math.abs(this.swipeX())>40&&(this.replyingTo.set(e),this.messageInput()?.nativeElement.focus(),navigator.vibrate&&navigator.vibrate(50),setTimeout(()=>{let i=document.getElementById("reply-bar");i&&this.animationService.slideInFromBottom(i,50)},10)),this.swipeX.set(0),this.swipeDirectionLocked=null,setTimeout(()=>this.swipingMsgId.set(null),300))}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=N({type:o,selectors:[["app-chat-room"]],viewQuery:function(e,i){e&1&&K(i.messagesContainer,Ze,5)(i.messageInput,et,5)(i.sendBtn,tt,5)(i.micBtn,it,5)(i.peerProfileTrigger,nt,5),e&2&&W(5)},decls:40,vars:22,consts:[["peerProfileTrigger",""],["statusText",""],["messagesContainer",""],["messageInput",""],["sendBtn",""],["micBtn",""],["id","chat-room-container",1,"flex","flex-col","h-screen","w-full","overflow-hidden","relative"],[1,"fixed","inset-0","pointer-events-none","z-0",2,"background","linear-gradient(180deg, var(--tg-gradient-start) 0%, transparent 30%, transparent 70%, var(--tg-gradient-end) 100%)","opacity","0.15"],[1,"safe-pt","px-2","pb-2","flex","items-center","z-20","sticky","top-0","glass-strong","border-b","border-white/10","relative"],[1,"p-2","mr-1","rounded-full","text-telegram-primary","hover:bg-white/10","transition-all","active:scale-90","z-10",3,"click"],[1,"ph","ph-caret-left","text-2xl"],[1,"flex","flex-1","items-center","gap-3","cursor-pointer","z-10",3,"click"],["size","sm",3,"src","name","isOnline"],[1,"flex","flex-col"],[1,"font-semibold","text-base","leading-tight"],[1,"text-xs","text-telegram-primary"],[1,"flex","items-center","gap-1","text-telegram-primary","z-10"],[1,"p-2","rounded-full","hover:bg-white/10","active:scale-90","transition-all",3,"click"],[1,"flex-1","overflow-y-auto","px-4","pt-4","flex","flex-col","gap-1","relative","telegram-pattern","custom-scrollbar"],["id","scroll-bottom-btn",1,"absolute","bottom-[80px]","right-4","z-30","w-10","h-10","rounded-full","bg-white","dark:bg-telegram-surface","shadow-lg","flex","items-center","justify-center","text-telegram-primary","hover:scale-110","active:scale-90","transition-all","border","border-gray-200","dark:border-gray-700"],["id","context-preview-backdrop",1,"fixed","inset-0","z-[100]","flex","items-center","justify-center","p-4",2,"background","rgba(10, 14, 20, 0.38)","backdrop-filter","blur(12px)","-webkit-backdrop-filter","blur(12px)"],["id","peer-profile-backdrop",1,"fixed","inset-0","z-[100]","flex","items-center","justify-center","p-4",2,"background","rgba(10, 14, 20, 0.42)","backdrop-filter","blur(12px)","-webkit-backdrop-filter","blur(12px)"],["id","reply-bar",1,"absolute","bottom-[80px]","left-3","right-3","px-3","py-2","flex","items-center","gap-2","z-30","bg-white","dark:bg-telegram-surface","rounded-2xl","shadow-md","shadow-black/5","dark:shadow-black/20"],["id","attachment-panel",1,"absolute","bottom-[80px]","left-3","right-3","p-4","z-30","bg-white","dark:bg-telegram-surface","shadow-xl","rounded-2xl"],[1,"safe-pb","absolute","bottom-0","left-0","right-0","z-20","px-4","pb-2","pt-2"],[1,"flex","items-end","px-3","py-2","gap-1.5","min-h-[52px]","bg-white/90","dark:bg-telegram-surface","rounded-3xl","shadow-xl","border","border-gray-200","dark:border-gray-700/50",2,"backdrop-filter","blur(16px)","-webkit-backdrop-filter","blur(16px)"],[1,"p-1.5","transition-all","mb-0.5","shrink-0","active:scale-90",3,"click"],[1,"ph","ph-smiley","text-2xl"],[1,"flex-1","flex","items-center","relative","min-h-[36px]","max-h-[120px]"],[1,"flex-1","flex","items-center","justify-between","px-2","h-9"],["placeholder","Message","rows","1",1,"w-full","bg-transparent","text-black","dark:text-white","py-2","outline-none","resize-none","no-scrollbar","max-h-[120px]","placeholder-gray-400","dark:placeholder-gray-500","text-[15px]","leading-snug",2,"border","none","box-shadow","none",3,"ngModel"],[1,"p-1.5","text-gray-400","hover:text-telegram-primary","transition-all","mb-0.5","shrink-0","active:scale-90",3,"click"],[1,"ph","ph-paperclip","text-xl","transform","-rotate-45"],[1,"relative","h-9","shrink-0","mb-0.5","flex","items-center","justify-end","overflow-visible"],[1,"absolute","right-0","w-full","flex","items-center","justify-end","gap-2"],[3,"label"],[1,"message-bubble","flex","flex-col","relative","z-10",3,"self-end","self-start","max-w-[80%]","mt-0","mt-2","transform","id","opacity"],[1,"message-bubble","flex","flex-col","relative","z-10",3,"touchstart","touchmove","touchend","contextmenu","id"],[1,"px-3","py-1.5","shadow-sm","text-[15px]","relative","group","transition-all"],[1,"text-xs","font-semibold","text-telegram-primary","mb-0.5"],[3,"audioUrl","durationMs","waveform","isMine"],[1,"leading-relaxed","whitespace-pre-wrap","break-words",3,"id"],[1,"flex","items-center","gap-1","text-[10px]","mt-0.5","justify-end","ml-3"],[1,"tabular-nums"],[1,"flex","flex-wrap","gap-1","mt-1",3,"self-end","self-start"],[1,"flex","items-center","gap-2","px-3","py-1.5","mb-0.5","rounded-xl","text-xs","cursor-pointer","opacity-80","hover:opacity-100","transition-opacity",3,"class"],[1,"flex","items-center","gap-2","px-3","py-1.5","mb-0.5","rounded-xl","text-xs","cursor-pointer","opacity-80","hover:opacity-100","transition-opacity",3,"click"],[1,"w-0.5","h-6","rounded-full"],[1,"min-w-0"],[1,"font-semibold","truncate"],[1,"truncate","text-gray-400"],[1,"ph","ph-clock","text-xs","opacity-60"],[1,"ph","ph-check","text-xs"],[1,"ph-bold","ph-checks","text-xs"],[1,"ph-bold","ph-checks","text-xs","text-green-400"],[1,"flex","flex-wrap","gap-1","mt-1"],[1,"flex","items-center","gap-0.5","px-1.5","py-0.5","rounded-full","text-xs","border","transition-all","hover:scale-105","active:scale-95",3,"class"],[1,"flex","items-center","gap-0.5","px-1.5","py-0.5","rounded-full","text-xs","border","transition-all","hover:scale-105","active:scale-95",3,"click"],[1,"font-medium"],["id","scroll-bottom-btn",1,"absolute","bottom-[80px]","right-4","z-30","w-10","h-10","rounded-full","bg-white","dark:bg-telegram-surface","shadow-lg","flex","items-center","justify-center","text-telegram-primary","hover:scale-110","active:scale-90","transition-all","border","border-gray-200","dark:border-gray-700",3,"click"],[1,"ph-bold","ph-caret-down","text-lg"],["id","context-preview-backdrop",1,"fixed","inset-0","z-[100]","flex","items-center","justify-center","p-4",2,"background","rgba(10, 14, 20, 0.38)","backdrop-filter","blur(12px)","-webkit-backdrop-filter","blur(12px)",3,"click"],["id","context-preview-card",1,"w-full","max-w-[340px]","flex","flex-col","gap-2",3,"click"],["id","context-preview-message",1,"w-full"],["id","context-preview-bubble",1,"px-3","py-2","shadow-xl","text-[15px]","transition-all"],[1,"leading-relaxed","whitespace-pre-wrap","break-words"],["id","context-preview-reactions",1,"flex","items-center","justify-center","gap-1","bg-white","dark:bg-telegram-surface","rounded-full","p-1.5","shadow-xl"],[1,"w-9","h-9","flex","items-center","justify-center","text-xl","rounded-full","hover:bg-gray-100","dark:hover:bg-gray-700","transition-all","hover:scale-125","active:scale-90"],["id","context-preview-actions",1,"bg-white","dark:bg-telegram-surface","rounded-2xl","shadow-xl","border","border-gray-100","dark:border-gray-700/50","p-1"],[1,"flex","items-center","gap-1"],[1,"flex-1","flex","flex-col","items-center","justify-center","gap-0.5","py-2","rounded-xl","text-xs","text-black","dark:text-white","hover:bg-gray-50","dark:hover:bg-gray-700/50","transition-colors",3,"click"],[1,"ph","ph-arrow-bend-up-left","text-lg"],[1,"ph","ph-share","text-lg"],[1,"ph","ph-copy","text-lg"],[1,"flex-1","flex","flex-col","items-center","justify-center","gap-0.5","py-2","rounded-xl","text-xs","text-red-500","hover:bg-red-50","dark:hover:bg-red-900/20","transition-colors",3,"click"],[1,"ph","ph-trash","text-lg"],[1,"flex","items-center","gap-0.5","px-1.5","py-0.5","rounded-full","text-xs","border",3,"class"],[1,"flex","items-center","gap-0.5","px-1.5","py-0.5","rounded-full","text-xs","border"],[1,"w-9","h-9","flex","items-center","justify-center","text-xl","rounded-full","hover:bg-gray-100","dark:hover:bg-gray-700","transition-all","hover:scale-125","active:scale-90",3,"click"],["id","peer-profile-backdrop",1,"fixed","inset-0","z-[100]","flex","items-center","justify-center","p-4",2,"background","rgba(10, 14, 20, 0.42)","backdrop-filter","blur(12px)","-webkit-backdrop-filter","blur(12px)",3,"click"],["id","peer-profile-card",1,"w-full",2,"max-width","360px",3,"click"],["id","peer-profile-island",1,"flex","flex-col","gap-3"],[1,"profile-field","flex","items-center","justify-between","bg-white/90","dark:bg-telegram-surface","rounded-2xl","border","border-gray-200","dark:border-gray-700/50","shadow-md","px-3","py-2",2,"backdrop-filter","blur(16px)","-webkit-backdrop-filter","blur(16px)"],[1,"text-sm","font-semibold","text-telegram-primary"],[1,"w-8","h-8","rounded-full","hover:bg-gray-100","dark:hover:bg-gray-700/50","transition-colors","active:scale-90",3,"click"],[1,"ph","ph-x","text-lg"],[1,"profile-field","flex","flex-col","items-center","gap-2","bg-white/90","dark:bg-telegram-surface","rounded-3xl","border","border-gray-200","dark:border-gray-700/50","shadow-md","px-4","py-3",2,"backdrop-filter","blur(16px)","-webkit-backdrop-filter","blur(16px)"],["id","peer-profile-avatar",1,"w-16","h-16","rounded-full","overflow-hidden","border","border-gray-200","dark:border-gray-700","shadow-md"],["alt","Profile avatar",1,"w-full","h-full",2,"object-fit","cover",3,"src"],[1,"w-full","h-full","bg-telegram-primary","text-white","flex","items-center","justify-center","font-bold","text-xl"],[1,"min-w-0","text-center"],[1,"text-xs","text-telegram-muted","truncate"],[1,"profile-field","flex","flex-col","gap-1","bg-white/90","dark:bg-telegram-surface","rounded-2xl","border","border-gray-200","dark:border-gray-700/50","shadow-md","px-3","py-2",2,"backdrop-filter","blur(16px)","-webkit-backdrop-filter","blur(16px)"],[1,"text-xs","text-telegram-muted"],[1,"text-sm","font-medium"],[1,"text-sm"],[1,"text-sm","leading-relaxed","whitespace-pre-wrap","break-words"],["id","emoji-picker-panel",1,"absolute","bottom-[80px]","left-3","right-3","z-30","flex","justify-center"],[3,"emojiSelected"],[1,"fixed","inset-0","z-20",3,"click"],[1,"w-0.5","h-8","bg-telegram-primary","rounded-full","shrink-0"],[1,"flex-1","min-w-0"],[1,"text-xs","font-semibold","text-telegram-primary"],[1,"text-xs","text-gray-500","truncate"],[1,"p-1","text-gray-400","hover:text-gray-600","transition-colors","active:scale-90",3,"click"],[1,"w-10","h-1","bg-gray-300","dark:bg-gray-600","rounded-full","mx-auto","mb-4"],[1,"grid","grid-cols-4","gap-4"],[1,"flex","flex-col","items-center","gap-2","group",3,"click"],[1,"w-14","h-14","rounded-2xl","bg-blue-500/10","text-blue-500","flex","items-center","justify-center","text-2xl","group-active:scale-90","transition-transform"],[1,"ph-fill","ph-image"],[1,"text-xs","font-medium"],[1,"w-14","h-14","rounded-2xl","bg-orange-500/10","text-orange-500","flex","items-center","justify-center","text-2xl","group-active:scale-90","transition-transform"],[1,"ph-fill","ph-file-text"],[1,"w-14","h-14","rounded-2xl","bg-purple-500/10","text-purple-500","flex","items-center","justify-center","text-2xl","group-active:scale-90","transition-transform"],[1,"ph-fill","ph-map-pin"],[1,"w-14","h-14","rounded-2xl","bg-gray-500/10","text-gray-500","flex","items-center","justify-center","text-2xl","group-active:scale-90","transition-transform"],[1,"ph","ph-x"],[1,"flex","items-center","gap-2"],[1,"w-2.5","h-2.5","rounded-full","bg-red-500","animate-pulse"],[1,"font-mono","text-red-400","font-medium","tabular-nums","text-sm"],["placeholder","Message","rows","1",1,"w-full","bg-transparent","text-black","dark:text-white","py-2","outline-none","resize-none","no-scrollbar","max-h-[120px]","placeholder-gray-400","dark:placeholder-gray-500","text-[15px]","leading-snug",2,"border","none","box-shadow","none",3,"ngModelChange","input","keydown.enter","ngModel"],[1,"w-9","h-9","rounded-full","bg-gray-200","dark:bg-gray-800","text-gray-600","dark:text-gray-300","flex","items-center","justify-center","shrink-0","active:scale-90","transition-transform",3,"click"],[1,"ph-fill","ph-trash","text-lg"],[1,"w-9","h-9","rounded-full","bg-telegram-primary","text-white","flex","items-center","justify-center","shrink-0","active:scale-90","transition-transform",3,"click"],[1,"ph-fill","ph-paper-plane-right","text-lg"],[1,"absolute","inset-0","w-9","h-9","rounded-full","bg-telegram-primary","text-white","flex","items-center","justify-center","opacity-0","scale-50","pointer-events-none","origin-center","shadow-md",3,"click"],[1,"absolute","inset-0","w-9","h-9","rounded-full","text-telegram-primary","hover:bg-white/10","flex","items-center","justify-center","origin-center","active:scale-90","transition-all",3,"click"],[1,"ph-fill","ph-microphone","text-2xl"]],template:function(e,i){if(e&1){let n=E();l(0,"div",6),f(1,"div",7),l(2,"header",8)(3,"button",9),x("click",function(){return m(n),p(i.goBack())}),f(4,"i",10),c(),l(5,"div",11,0),x("click",function(d){return m(n),p(i.openPeerProfile(d))}),f(7,"app-avatar",12),l(8,"div",13)(9,"h2",14),u(10),c(),l(11,"span",15,1),u(13),c()()(),l(14,"div",16)(15,"button",17),x("click",function(d){return m(n),p(i.themeService.toggleTheme(d))}),f(16,"i"),c()()(),l(17,"div",18,2),P(19,vt,2,1,null,null,ot),_(21,Ct,1,0,"app-typing-indicator"),c(),_(22,yt,2,0,"button",19),_(23,Mt,35,13,"div",20),_(24,Pt,33,7,"div",21),_(25,Vt,3,0),_(26,jt,9,2,"div",22),_(27,Bt,23,0,"div",23),l(28,"footer",24)(29,"div",25)(30,"button",26),x("click",function(){return m(n),p(i.toggleEmojiPicker())}),f(31,"i",27),c(),l(32,"div",28),_(33,Dt,7,1,"div",29)(34,Lt,2,1,"textarea",30),c(),l(35,"button",31),x("click",function(){return m(n),p(i.toggleAttachmentPanel())}),f(36,"i",32),c(),l(37,"div",33),_(38,At,5,0,"div",34)(39,Nt,6,0),c()()()()}if(e&2){let n,r,d,h;a(7),$("src",((n=i.chat())==null?null:n.type)==="direct"?(n=i.participant())==null?null:n.avatarUrl:(n=i.chat())==null?null:n.avatarUrl)("name",((r=i.chat())==null?null:r.type)==="direct"?((r=i.participant())==null?null:r.name)||"":((r=i.chat())==null?null:r.name)||"")("isOnline",((d=i.participant())==null?null:d.isOnline)||!1),a(3),R(" ",((h=i.chat())==null?null:h.type)==="direct"?(h=i.participant())==null?null:h.name:(h=i.chat())==null?null:h.name," "),a(3),R(" ",i.statusString()," "),a(3),M("ph "+i.themeService.getThemeInfo(i.themeService.currentTheme()).icon+" text-xl"),a(),Z("padding-bottom",i.replyingTo()?"9.25rem":"6rem"),a(2),V(i.displayItems()),a(2),v(i.isTyping()?21:-1),a(),v(i.showScrollBtn()?22:-1),a(),v(i.contextMenuMsg()?23:-1),a(),v(i.showPeerProfileCard()&&i.peerProfile()?24:-1),a(),v(i.showEmojiPicker()?25:-1),a(),v(i.replyingTo()?26:-1),a(),v(i.showAttachmentPanel()?27:-1),a(3),M(i.showEmojiPicker()?"text-telegram-primary":"text-gray-400 hover:text-telegram-primary"),a(3),v(i.voiceRecorder.isRecording()?33:34),a(4),Z("width",i.voiceRecorder.isRecording()?"5rem":"2.25rem"),a(),v(i.voiceRecorder.isRecording()?38:39)}},dependencies:[Se,te,ne,oe,re,Pe,Me,Ie,Re,Te],encapsulation:2})}};export{je as ChatRoomComponent};
